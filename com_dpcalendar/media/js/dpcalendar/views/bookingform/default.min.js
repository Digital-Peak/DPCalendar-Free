DPCalendar=window.DPCalendar||{},function(o,i,r){"use strict";function c(){if(i.getOptions("DPCalendar.price.url")&&o.querySelector(".dp-price-total__content")){var e=o.querySelector(".com-dpcalendar-bookingform__form"),t=r.formToQueryString(e,'input:not([name="task"]), select');r.request(i.getOptions("DPCalendar.price.url"),function(d){Object.keys(d.data.events).map(function(a){var l=e.querySelector('[data-event-id="'+a+'"]');Object.keys(d.data.events[a]).map(function(c){Object.keys(d.data.events[a][c]).map(function(e){var t=d.data.events[a][c][e],n=c.substring(0,c.length-1),o=l.querySelector("[data-"+n+'-price="'+e+'"]');if(o){var i,r=o.querySelector(".dp-price__live");if(r)if(r.innerHTML=t.discount,t.discount!=t.original)o.querySelector(".dp-price__live").classList.remove("dp-price_hidden"),o.querySelector(".dp-price__original").classList.remove("dp-price_hidden"),o.querySelector(".dp-price__original").innerHTML=t.original,(i=o.querySelector(".dp-"+n+"__price-info .dp-icon"))&&i.classList.remove("dp-price_hidden");else o.querySelector(".dp-price__original").classList.add("dp-price_hidden"),(i=o.querySelector(".dp-"+n+"__price-info .dp-icon"))&&i.classList.add("dp-price_hidden")}})})}),o.querySelector(".dp-price-total__content").innerHTML=d.data.total},t)}}o.addEventListener("DOMContentLoaded",function(){c(),[].slice.call(o.querySelectorAll(".dp-booking-series__input label")).forEach(function(e){c()}),[].slice.call(o.querySelectorAll(".dp-booking-series__input input")).forEach(function(e){e.addEventListener("click",function(){var t=o.getElementById("jform_series0").checked;[].slice.call(o.querySelectorAll(".com-dpcalendar-bookingform__events .dp-event_instance")).forEach(function(e){e.style.display=t?"inherit":"none",e.querySelector("select").value=t?"1":"0"}),c()})}),[].slice.call(o.querySelectorAll(".dp-ticket__amount .dp-select, .dp-option__amount .dp-select")).forEach(function(e){e.addEventListener("change",function(){c()})});var n=[].slice.call(o.querySelectorAll(".com-dpcalendar-bookingform__fields .dp-input-terms"));n.forEach(function(e){e.addEventListener("change",function(){var t=!0;n.forEach(function(e){e.checked||(t=!1)}),o.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!t})}),n.length&&(o.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!0),[].slice.call(o.querySelectorAll(".com-dpcalendar-bookingform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=o.querySelectorAll(".dp-payment-option");"save"==this.getAttribute("data-task")&&1==t.length&&(t[0].querySelector(".dp-payment-option__input").checked=!0);var n=o.querySelector(".dp-price-total__content");return"save"==this.getAttribute("data-task")&&n&&n.innerHTML&&1<t.length&&!o.querySelectorAll(".dp-payment-option__input:checked").length?(r.slideToggle(o.querySelector(".com-dpcalendar-bookingform__payment-options")),[].slice.call(o.querySelectorAll(".dp-payment-option")).forEach(function(e){e.addEventListener("click",function(){this.querySelector(".dp-payment-option__input").checked=!0,i.submitbutton("bookingform.save")})})):i.submitbutton("bookingform."+this.getAttribute("data-task")),!1})}),i.submitbutton=function(e){var t=o.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||o.formvalidator.isValid(t))&&i.submitform(e,t)}}),r.updateBookingMail=function(e){r.request("task=booking.mail",function(e){e.success&&(o.getElementById("jform_name").value=e.data.name,o.getElementById("jform_email").value=e.data.email)},"ajax=1&id="+o.getElementById("jform_user_id_id").value)}}(document,Joomla,DPCalendar);
