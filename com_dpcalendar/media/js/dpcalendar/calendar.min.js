DPCalendar=window.DPCalendar||{},function(s,m,E,v){"use strict";s.addEventListener("DOMContentLoaded",function(){[].slice.call(s.querySelectorAll(".dp-calendar")).forEach(function(e){if(e.getAttribute("data-options")){var t=E.getOptions(e.getAttribute("data-options"));"string"==typeof(t=Object.assign(t,e.dataset)).hiddenDays&&(t.hiddenDays=JSON.parse(t.hiddenDays)),v.createCalendar(e,t)}})}),v.createCalendar=function(c,u){c.parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden");var a=E.getOptions("DPCalendar.calendar.names"),p=[];p.month="dayGridMonth",p.week="timeGridWeek",p.day="timeGridDay",p.list="list",p.resyear="resourceTimelineYear",p.resmonth="resourceTimelineMonth",p.resweek="resourceTimelineWeek",p.resday="resourceTimelineDay",p.agendaWeek="timeGridWeek",p.agendaDay="timeGridDay";var _=[];if(_.dayGridMonth="month",_.timeGridWeek="week",_.timeGridDay="day",_.list="list",_.resourceTimelineYear="resyear",_.resourceTimelineMonth="resmonth",_.resourceTimelineWeek="resweek",_.resourceTimelineDay="resday",_.agendaWeek="week",_.agendaDay="day",null!=u.resources&&(p.week="resourceTimeGridWeek",p.day="resourceTimeGridDay",_.resourceTimeGridWeek="week",_.resourceTimeGridDay="day"),u.use_hash){for(var e=m.location.hash.replace(/&amp;/gi,"&").split("&"),t=0;t<e.length;t++)e[t].match("^#year")&&(u.year=e[t].substring(6)),e[t].match("^month")&&(u.month=e[t].substring(6)),e[t].match("^day")&&(u.date=e[t].substring(4)),e[t].match("^view")&&(u.defaultView=e[t].substring(5));m.addEventListener("hashchange",function(){for(var e=new Date,t=e.getUTCFullYear(),a=e.getUTCMonth()+1,r=e.getUTCDate(),n=_[u.defaultView],i=m.location.hash.replace(/&amp;/gi,"&").split("&"),o=0;o<i.length;o++)i[o].match("^#year")&&(t=i[o].substring(6)),i[o].match("^month")&&(a=i[o].substring(6)-1),i[o].match("^day")&&(r=i[o].substring(4)),i[o].match("^view")&&(n=i[o].substring(5));var d=new Date(Date.UTC(t,a,r,0,0,0)),l=c.dpCalendar.getDate(),s=c.dpCalendar.view;d.getUTCFullYear()==l.getUTCFullYear()&&d.getUTCMonth()==l.getUTCMonth()&&d.getUTCDate()==l.getUTCDate()||c.dpCalendar.gotoDate(d),s.type!=p[n]&&c.dpCalendar.changeView(p[n])})}u.defaultDate=new Date(u.year+"-"+v.pad(parseInt(u.month),2)+"-"+v.pad(u.date,2)),u.timeZone=E.getOptions("DPCalendar.timezone"),u.defaultView=p[u.defaultView],s.body.clientWidth<u.screen_size_list_view&&(u.defaultView=p.list),u.schedulerLicenseKey="GPL-My-Project-Is-Open-Source",u.weekNumberTitle="",u.eventLimitText=E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_MORE"),u.allDayText=E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_ALL_DAY"),u.buttonText={today:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_TODAY"),year:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_YEAR"),month:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_MONTH"),week:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_WEEK"),day:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_DAY"),list:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_LIST")},u.listTexts={until:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_UNTIL"),past:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_PAST"),today:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TODAY"),tomorrow:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TOMORROW"),thisWeek:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_WEEK"),nextWeek:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_WEEK"),thisMonth:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_MONTH"),nextMonth:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_MONTH"),future:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_FUTURE"),week:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_WEEK")},u.datesRender=function(e){var t=e.view.calendar.getDate(),a="year="+t.getUTCFullYear()+"&month="+(t.getUTCMonth()+1)+"&day="+t.getUTCDate()+"&view="+_[e.view.type];u.use_hash&&m.location.hash.replace(/&amp;/gi,"&").replace("#","")!=a&&(m.location.hash=a);var r=c.parentElement.querySelector(".dp-map");v.Map&&null!=r&&u.show_map&&v.Map.clearMarkers(r)},u.eventRender=function(a){var e=a.el.querySelector(".fc-title");e&&(e.innerHTML=e.textContent),a.event.view_class&&a.el.classList.add(a.event.view_class);var r=a.event.extendedProps.description;r&&(r=(r=r.replace("task=event.delete","task=event.delete&urlhash="+encodeURIComponent(m.location.hash))).replace("task=event.edit","task=event.edit&urlhash="+encodeURIComponent(m.location.hash)),a.isMirror||(s.createElement("div").innerHTML=r,tippy(a.el,{interactive:!0,delay:100,arrow:!0,content:r,ignoreAttributes:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}})));a.event.extendedProps.fgcolor&&a.view.type!=p.list&&(a.el.style.color=a.event.extendedProps.fgcolor);var n=c.parentElement.querySelector(".dp-map");v.Map&&null!=n&&u.show_map&&a.event.extendedProps.location.forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.title=a.event.title,t.color=a.event.backgroundColor,a.event.url&&r&&(r=r.replace(a.event.title,'<a href="'+a.event.url+'">'+a.event.title+"</a>")),t.description=r,v.Map.createMarker(n,t)})},u.eventDataTransform=function(e){if(e.allDay){var t=moment(e.end);t.add(1,"day"),e.end=t.format("YYYY-MM-DD")}return e},u.eventDragStart=function(e){e.el._tippy&&e.el._tippy.destroy()},u.eventDrop=function(a){if(a.event.resourceId)return a.revert(),!1;v.request("task=event.move&Itemid="+E.getOptions("DPCalendar.itemid"),function(e){if(e.data.url&&a.event.setProp("url",e.data.url),e.data.description&&a.event.setExtendedProp("description",e.data.description),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void a.revert()}else a.revert();else a.revert()},"id="+a.event.id+"&minutes="+moment.duration(a.delta).asMinutes()+"&allDay="+a.event.allDay)},u.eventResize=function(a){a.el._tippy&&a.el._tippy.destroy(),v.request("task=event.move&Itemid="+E.getOptions("DPCalendar.itemid"),function(e){if(e.data.url&&a.event.setProp("url",e.data.url),e.data.description&&a.event.setExtendedProp("description",e.data.description),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void a.revert()}else a.revert();else a.revert()},"id="+a.event.id+"&minutes="+moment.duration(a.endDelta).asMinutes()+"&onlyEnd=1&allDay="+a.event.allDay)},u.eventClick=function(e){if(e.jsEvent.preventDefault(),e.jsEvent.currentTarget._tippy&&e.jsEvent.currentTarget._tippy.hide(),2!=u.show_event_as_popup)if(1==u.show_event_as_popup){var t=new Url(e.event.url);t.query.tmpl="component",v.modal(t,c.dataset.popupwidth,c.dataset.popupheight,function(e){var t=e.contentDocument||e.contentWindow.document;!t.getElementById("system-message-container")||t.getElementById("system-message-container").children.length<1||c.refetchEvents()})}else m.location=v.encode(e.event.url)},u.dateClick=function(e){var t=c.parentElement.querySelector(".dp-quickadd .dp-form"),a=moment.utc(e.date);if(t){e.jsEvent.preventDefault(),e.view.type==p.month&&(a.hours(8),a.minutes(0));var r=t.querySelector("#jform_start_date");r.value=a.format(r.getAttribute("data-format")),r.actualDate=r.value,(r=t.querySelector("#jform_start_date_time")).value=a.format(r.getAttribute("data-format")),r.actualDate=r.value,a.add(1,"hours");var n=t.querySelector("#jform_end_date");if(n.value=a.format(n.getAttribute("data-format")),n.actualDate=n.value,(n=t.querySelector("#jform_end_date_time")).value=a.format(n.getAttribute("data-format")),n.actualDate=n.value,e.resource){var i=e.resource.id.split("-");t.querySelector('input[name="jform[location_ids][]"]').value=[i[0]],1<i.length&&(t.querySelector('input[name="jform[rooms][]"]').value=[e.resource.id])}1==u.event_create_form&&600<m.innerWidth?(new Popper(e.jsEvent.target,t.parentElement,{onCreate:function(e){e.instance.popper.querySelector("#jform_title").focus()}}),t.parentElement.style.display="block"):(t.querySelector("input[name=task]").value="",t.submit())}else 0<u.header.right.indexOf(p.day)&&(c.dpCalendar.gotoDate(e.date),c.dpCalendar.changeView(p.day))},u.customButtons={},u.header.left.indexOf("datepicker")&&(u.customButtons.datepicker={text:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_SHOW_DATEPICKER"),icon:"icon-calendar",click:function(){var e=s.querySelector(".fc-datepicker-button"),t=e.querySelector("input");t||((t=s.createElement("input")).setAttribute("type","hidden"),t.id="datepicker-input",e.appendChild(t),t.dpPicker=new Pikaday({field:t,trigger:e,i18n:{months:a.monthNames,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort},onSelect:function(e){var t="year="+e.getFullYear()+"&month="+(e.getMonth()+1)+"&day="+e.getDate()+"&view="+_[c.dpCalendar.view.type];u.use_hash&&m.location.hash.replace(/&amp;/gi,"&").replace("#","")!=t?m.location.hash=t:c.dpCalendar.gotoDate(e)}})),t.dpPicker.show()}}),u.header.left.indexOf("print")&&(u.customButtons.print={text:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-print",click:function(){var e=s.location.href.replace(/\?/,"?layout=print&tmpl=component&");e==s.location.href&&(e=s.location.href.replace(/#/,"?layout=print&tmpl=component#")),m.open(e).focus()}}),u.header.left.indexOf("add")&&u.event_create_url&&(u.customButtons.add={text:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-add",click:function(){location.href=u.event_create_url}}),u.loading=function(e){e?c.parentElement.parentElement.querySelector(".dp-loader").classList.remove("dp-loader_hidden"):c.parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden")};var n=c.getAttribute("data-options")+"-calendar-state-"+md5(u.calendarIds);v.isLocalStorageSupported()&&(null==localStorage.getItem(n)?localStorage.setItem(n,JSON.stringify(u.calendarIds)):u.calendarIds=JSON.parse(localStorage.getItem(n)).filter(function(e){return-1!==u.calendarIds.indexOf(e)})),moment.updateLocale("en",{months:a.monthNames,monthsShort:a.monthNamesShort,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort,weekdaysMin:a.dayNamesMin}),u.plugins=["dayGrid","timeGrid","list","interaction","moment"];var r=u.views;u.views={},Object.keys(r).forEach(function(e){var t=r[e].titleFormat;r[e].titleFormat=function(e){return moment(e.start).format(t)},u.views[p[e]]=r[e]});var i="";u.header.right.split(",").forEach(function(e,t){i+=p[e]+","}),-1!=(u.header.right=i).indexOf("resource")?(u.plugins.push("resourceTimeline"),u.plugins.push("resourceTimeGrid")):u.resources&&u.plugins.push("resourceTimeGrid"),u.eventSources=[],u.calendarIds.forEach(function(r,e){u.eventSources[e]={id:r,events:function(e,t,a){v.request(u.requestUrlRoot+"&ids="+r+"&date-start="+e.startStr+"&date-end="+e.endStr,function(e){t(e.data)},null,!1)}}});var o=new FullCalendar.Calendar(c,u);(c.dpCalendar=o).render();var d=c.parentElement,l=d.querySelector(".com-dpcalendar-calendar__toggle");l&&l.addEventListener("click",function(){v.slideToggle(d.querySelector(".com-dpcalendar-calendar__list"),function(e){e?(d.querySelector('[data-direction="up"]').style.display="inline",d.querySelector('[data-direction="down"]').style.display="none"):(d.querySelector('[data-direction="up"]').style.display="none",d.querySelector('[data-direction="down"]').style.display="inline")})}),[].slice.call(c.parentElement.querySelectorAll(".com-dpcalendar-calendar__list .dp-input-checkbox")).forEach(function(t){u.calendarIds.forEach(function(e){e==t.value&&t.setAttribute("checked",!0)}),t.addEventListener("click",function(){var a=v.isLocalStorageSupported()?JSON.parse(localStorage.getItem(n)):[],r=t.value;t.checked?(c.dpCalendar.addEventSource({id:r,events:function(e,t,a){v.request(u.requestUrlRoot+"&ids="+r+"&date-start="+e.startStr+"&date-end="+e.endStr,function(e){t(e.data)},null,!1)}}),a.push(r)):(c.dpCalendar.getEventSources().forEach(function(e){e.id==r&&e.remove()}),a.forEach(function(e,t){e==r&&a.splice(t,1)})),v.isLocalStorageSupported()&&localStorage.setItem(n,JSON.stringify(a))})})}}(document,window,Joomla,DPCalendar);
