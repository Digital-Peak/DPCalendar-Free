DPCalendar=window.DPCalendar||{},function(r,a,i){"use strict";function o(){if(a.getOptions("DPCalendar.price.url")&&r.querySelector(".dp-price-total__content")){var t=r.querySelector(".com-dpcalendar-bookingform__form"),e=i.formToQueryString(t,'input:not([name="task"]), select');i.request(a.getOptions("DPCalendar.price.url"),function(p){var s=a.JText._("COM_DPCALENDAR_VIEW_BOOKINGFORM_TAX_"+(1==p.data.taxinclusive?"IN":"EX")+"CLUSIVE_TEXT"),u=a.JText._("COM_DPCALENDAR_VIEW_BOOKINGFORM_DISCOUNT");Object.keys(p.data.events).map(function(l){var d=t.querySelector('[data-event-id="'+l+'"]');Object.keys(p.data.events[l]).map(function(c){Object.keys(p.data.events[l][c]).map(function(e){var t=p.data.events[l][c][e],n=c.substring(0,c.length-1),o=d.querySelector("[data-"+n+'-price="'+e+'"]');if(o){var r=o.querySelector(".dp-price__live");if(r){var a=o.querySelector(".dp-price__info"),i="";r.innerHTML=t.discount,t.discount!=t.original?(o.querySelector(".dp-price__live").classList.remove("dp-price_hidden"),o.querySelector(".dp-price__original").classList.remove("dp-price_hidden"),o.querySelector(".dp-price__original").innerHTML=t.original,i=u):(o.querySelector(".dp-price__original").classList.add("dp-price_hidden"),a&&a.classList.add("dp-price_hidden")),p.data.tax&&"0.00"!=t.raw&&(i+=(i?"<br>":"")+s),a&&i&&(a.classList.remove("dp-price_hidden"),tippy(a,{interactive:!0,delay:100,arrow:!0,content:i,ignoreAttributes:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}}))}}})})}),r.querySelector(".com-dpcalendar-bookingform .dp-price-total__content").innerHTML=p.data.total,r.querySelector(".com-dpcalendar-bookingform .dp-price-total__content").setAttribute("data-raw",p.data.totalraw);var e=r.querySelector(".com-dpcalendar-bookingform .dp-tax");p.data.tax?(e.style.display="inline-block",e.querySelector(".dp-tax__content").innerHTML=p.data.tax,e.querySelector(".dp-tax__title").innerHTML="("+p.data.taxtitle+")",tippy(e.querySelector(".dp-tax__icon"),{interactive:!0,delay:100,arrow:!0,content:s,ignoreAttributes:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}})):e.style.display="none"},e)}}r.addEventListener("DOMContentLoaded",function(){o(),[].slice.call(r.querySelectorAll(".dp-booking-series__input input")).forEach(function(e){e.addEventListener("click",function(){var t=r.getElementById("jform_series0").checked;[].slice.call(r.querySelectorAll(".com-dpcalendar-bookingform__events .dp-event_instance")).forEach(function(e){e.style.display=t?"inherit":"none",e.querySelector("select").value=t?"1":"0"}),o()})}),[].slice.call(r.querySelectorAll(".dp-ticket__amount .dp-select, .dp-option__amount .dp-select, .dp-field-country .dp-select")).forEach(function(e){e.addEventListener("change",function(){o()})});var n=[].slice.call(r.querySelectorAll(".com-dpcalendar-bookingform__fields .dp-input-terms"));n.forEach(function(e){e.addEventListener("change",function(){var t=!0;n.forEach(function(e){e.checked||(t=!1)}),r.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!t})}),n.length&&(r.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!0),[].slice.call(r.querySelectorAll(".com-dpcalendar-bookingform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=r.querySelectorAll(".dp-payment-option");"save"==this.getAttribute("data-task")&&1==t.length&&(t[0].querySelector(".dp-payment-option__input").checked=!0);var n=r.querySelector(".dp-price-total__content");if("save"==this.getAttribute("data-task")&&0<t.length&&n&&0==n.getAttribute("data-raw")&&(t[0].querySelector(".dp-payment-option__input").checked=!0),"save"==this.getAttribute("data-task")&&1<t.length&&!r.querySelectorAll(".dp-payment-option__input:checked").length){var o=r.getElementsByName("adminForm")[0];return o&&!r.formvalidator.isValid(o)||(i.slideToggle(r.querySelector(".com-dpcalendar-bookingform__payment-options")),[].slice.call(r.querySelectorAll(".dp-payment-option")).forEach(function(e){e.addEventListener("click",function(){this.querySelector(".dp-payment-option__input").checked=!0,a.submitbutton("bookingform.save")})})),!1}return a.submitbutton("bookingform."+this.getAttribute("data-task")),!1})}),a.submitbutton=function(e){var t=r.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||r.formvalidator.isValid(t))&&a.submitform(e,t)},[].slice.call(r.querySelectorAll(".com-dpcalendar-bookingform .dp-field-country .dp-select")).forEach(function(e){e._choicejs=new Choices(e,{itemSelectText:"",noChoicesText:"",shouldSortItems:!1,shouldSort:!1,searchResultLimit:30})})}),i.updateBookingMail=function(e){i.request("task=booking.mail",function(e){e.success&&(r.getElementById("jform_name").value=e.data.name,r.getElementById("jform_email").value=e.data.email)},"ajax=1&id="+r.getElementById("jform_user_id_id").value)}}(document,Joomla,DPCalendar);