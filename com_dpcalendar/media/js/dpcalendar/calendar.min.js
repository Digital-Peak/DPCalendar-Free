DPCalendar=window.DPCalendar||{},function(s,p,E,v){"use strict";s.addEventListener("DOMContentLoaded",function(){[].slice.call(s.querySelectorAll(".dp-calendar")).forEach(function(e){if(e.getAttribute("data-options")){var t=E.getOptions(e.getAttribute("data-options"));"string"==typeof(t=Object.assign(t,e.dataset)).hiddenDays&&(t.hiddenDays=JSON.parse(t.hiddenDays)),v.createCalendar(e,t)}})}),v.createCalendar=function(c,u){c.parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden");var a=E.getOptions("DPCalendar.calendar.names"),_=[];_.month="dayGridMonth",_.week="timeGridWeek",_.day="timeGridDay",_.list="list",_.resyear="resourceTimelineYear",_.resmonth="resourceTimelineMonth",_.resweek="resourceTimelineWeek",_.resday="resourceTimelineDay",_.agendaWeek="timeGridWeek",_.agendaDay="timeGridDay";var m=[];if(m.dayGridMonth="month",m.timeGridWeek="week",m.timeGridDay="day",m.list="list",m.resourceTimelineYear="resyear",m.resourceTimelineMonth="resmonth",m.resourceTimelineWeek="resweek",m.resourceTimelineDay="resday",m.agendaWeek="week",m.agendaDay="day",null!=u.resources&&(_.week="resourceTimeGridWeek",_.day="resourceTimeGridDay",m.resourceTimeGridWeek="week",m.resourceTimeGridDay="day"),u.use_hash){for(var e=p.location.hash.replace(/&amp;/gi,"&").split("&"),t=0;t<e.length;t++)e[t].match("^#year")&&(u.year=e[t].substring(6)),e[t].match("^month")&&(u.month=e[t].substring(6)),e[t].match("^day")&&(u.date=e[t].substring(4)),e[t].match("^view")&&(u.defaultView=e[t].substring(5));p.addEventListener("hashchange",function(){for(var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),n=m[u.defaultView],o=p.location.hash.replace(/&amp;/gi,"&").split("&"),i=0;i<o.length;i++)o[i].match("^#year")&&(t=o[i].substring(6)),o[i].match("^month")&&(a=o[i].substring(6)-1),o[i].match("^day")&&(r=o[i].substring(4)),o[i].match("^view")&&(n=o[i].substring(5));var l=new Date(Date.UTC(t,a,r,0,0,0)),d=c.dpCalendar.getDate(),s=c.dpCalendar.view;l.getYear()==d.getYear()&&l.getMonth()==d.getMonth()&&l.getDate()==d.getDate()||c.dpCalendar.gotoDate(l),s.type!=n&&c.dpCalendar.changeView(_[n])})}u.defaultDate=new Date(u.year+"-"+v.pad(parseInt(u.month),2)+"-"+v.pad(u.date,2)),u.timeZone=E.getOptions("DPCalendar.timezone"),u.defaultView=_[u.defaultView],s.body.clientWidth<u.screen_size_list_view&&(u.defaultView=_.list),u.schedulerLicenseKey="GPL-My-Project-Is-Open-Source",u.weekNumberTitle="",u.eventLimitText=E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_MORE"),u.allDayText=E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_ALL_DAY"),u.buttonText={today:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_TODAY"),year:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_YEAR"),month:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_MONTH"),week:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_WEEK"),day:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_DAY"),list:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_LIST")},u.listTexts={until:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_UNTIL"),past:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_PAST"),today:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TODAY"),tomorrow:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TOMORROW"),thisWeek:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_WEEK"),nextWeek:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_WEEK"),thisMonth:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_MONTH"),nextMonth:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_MONTH"),future:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_FUTURE"),week:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_WEEK")},u.datesRender=function(e){var t=e.view.calendar.getDate(),a="year="+t.getFullYear()+"&month="+(t.getMonth()+1)+"&day="+t.getDate()+"&view="+m[e.view.type];u.use_hash&&p.location.hash.replace(/&amp;/gi,"&")!=a&&(p.location.hash=a);var r=c.parentElement.querySelector(".dp-map");null!=r&&u.show_map&&v.Map.clearMarkers(r)},u.eventRender=function(a){var e=a.el.querySelector(".fc-title");e&&(e.innerHTML=e.textContent),a.event.view_class&&a.el.classList.add(a.event.view_class);var r=a.event.extendedProps.description;r&&(r=(r=r.replace("task=event.delete","task=event.delete&urlhash="+encodeURIComponent(p.location.hash))).replace("task=event.edit","task=event.edit&urlhash="+encodeURIComponent(p.location.hash)),a.isMirror||(s.createElement("div").innerHTML=r,tippy(a.el,{interactive:!0,delay:100,arrow:!0,content:r,ignoreAttributes:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}})));a.event.fgcolor&&"list"!=a.view.type&&(a.el.style.color=a.event.fgcolor);var n=c.parentElement.querySelector(".dp-map");null!=n&&u.show_map&&a.event.extendedProps.location.forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.title=a.event.title,t.color=a.event.backgroundColor,a.event.url&&r&&(r=r.replace(a.event.title,'<a href="'+a.event.url+'">'+a.event.title+"</a>")),t.description=r,v.Map.createMarker(n,t)})},u.eventDataTransform=function(e){if(e.allDay){var t=moment(e.end);t.add(1,"day"),e.end=t.format("YYYY-MM-DD")}return e},u.eventDragStart=function(e){e.el._tippy&&e.el._tippy.destroy()},u.eventDrop=function(a){if(a.event.resourceId)return a.revert(),!1;v.request("task=event.move",function(e){if(e.data.url&&a.event.setProp("url",e.data.url),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void a.revert()}else a.revert();else a.revert()},"id="+a.event.id+"&minutes="+moment.duration(a.delta).asMinutes()+"&allDay="+a.event.allDay)},u.eventResize=function(a){a.el._tippy&&a.el._tippy.destroy(),v.request("task=event.move",function(e){if(e.data.url&&a.event.setProp("url",e.data.url),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void a.revert()}else a.revert();else a.revert()},"id="+a.event.id+"&minutes="+moment.duration(a.endDelta).asMinutes()+"&onlyEnd=1&allDay="+a.event.allDay)},u.eventClick=function(e){if(e.jsEvent.preventDefault(),e.jsEvent.currentTarget._tippy&&e.jsEvent.currentTarget._tippy.hide(),2!=u.show_event_as_popup)if(1==u.show_event_as_popup){var t=new Url(e.event.url);t.query.tmpl="component",v.modal(t,c.dataset.popupwidth,c.dataset.popupheight,function(e){var t=e.contentDocument||e.contentWindow.document;!t.getElementById("system-message-container")||t.getElementById("system-message-container").children.length<1||c.refetchEvents()})}else p.location=v.encode(e.event.url)},u.dateClick=function(e){var t=c.parentElement.querySelector(".dp-quickadd .dp-form"),a=moment.utc(e.date);if(t){e.jsEvent.preventDefault(),e.view.type==_.month&&(a.hours(8),a.minutes(0));var r=t.querySelector("#jform_start_date");r.value=a.format(r.getAttribute("data-format")),r.actualDate=r.value,(r=t.querySelector("#jform_start_date_time")).value=a.format(r.getAttribute("data-format")),r.actualDate=r.value,a.add(1,"hours");var n=t.querySelector("#jform_end_date");if(n.value=a.format(n.getAttribute("data-format")),n.actualDate=n.value,(n=t.querySelector("#jform_end_date_time")).value=a.format(n.getAttribute("data-format")),n.actualDate=n.value,e.resource){var o=e.resource.id.split("-");t.querySelector('input[name="jform[location_ids][]"]').value=[o[0]],1<o.length&&(t.querySelector('input[name="jform[rooms][]"]').value=[resource.id])}1==u.event_create_form&&600<p.innerWidth?(new Popper(e.jsEvent.target,t.parentElement,{onCreate:function(e){e.instance.popper.querySelector("#jform_title").focus()}}),t.parentElement.style.display="block"):(t.querySelector("input[name=task]").value="",t.submit())}else 0<u.header.right.indexOf("agendaDay")&&(c.dpCalendar.gotoDate(a),c.dpCalendar.changeView("agendaDay"))},u.customButtons={},u.header.left.indexOf("datepicker")&&(u.customButtons.datepicker={text:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_SHOW_DATEPICKER"),icon:"icon-calendar",click:function(){var e=s.querySelector(".fc-datepicker-button"),t=e.querySelector("input");t||((t=s.createElement("input")).setAttribute("type","hidden"),t.id="datepicker-input",e.appendChild(t));var r=new Pikaday({field:t,trigger:e,i18n:{months:a.monthNames,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort},onSelect:function(e){var t=r.getMoment(),a="year="+t.year()+"&month="+(t.month()+1)+"&day="+t.date()+"&view="+c.dpCalendar.view.type;u.use_hash&&p.location.hash.replace(/&amp;/gi,"&")!=a?p.location.hash=a:c.gotoDate(t),this.destroy()}});r.show()}}),u.header.left.indexOf("print")&&(u.customButtons.print={text:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-print",click:function(){var e=s.location.href.replace(/\?/,"?layout=print&tmpl=component&");e==s.location.href&&(e=s.location.href.replace(/#/,"?layout=print&tmpl=component#")),p.open(e).focus()}}),u.header.left.indexOf("add")&&u.event_create_url&&(u.customButtons.add={text:E.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-add",click:function(){location.href=u.event_create_url}}),u.loading=function(e){e?c.parentElement.parentElement.querySelector(".dp-loader").classList.remove("dp-loader_hidden"):c.parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden")};var n=c.getAttribute("data-options")+"-calendar-state";v.isLocalStorageSupported()&&(null==localStorage.getItem(n)?localStorage.setItem(n,JSON.stringify(u.calendarIds)):u.calendarIds=JSON.parse(localStorage.getItem(n))),moment.updateLocale("en",{months:a.monthNames,monthsShort:a.monthNamesShort,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort,weekdaysMin:a.dayNamesMin}),u.plugins=["dayGrid","timeGrid","list","interaction","moment"];var r=u.views;u.views={},Object.keys(r).forEach(function(e){var t=r[e].titleFormat;r[e].titleFormat=function(e){return moment(e.start).format(t)},u.views[_[e]]=r[e]});var o="";u.header.right.split(",").forEach(function(e){o+=_[e]+","}),-1!=(u.header.right=o).indexOf("resource")?u.plugins=["resourceTimeline","moment"]:u.resources&&u.plugins.push("resourceTimeGrid"),u.eventSources=[],u.calendarIds.forEach(function(r,e){u.eventSources[e]={id:r,events:function(e,t,a){v.request(u.requestUrlRoot+"&ids="+r+"&date-start="+e.startStr+"&date-end="+e.endStr,function(e){t(e.data)})}}});var i=new FullCalendar.Calendar(c,u);(c.dpCalendar=i).render();var l=c.parentElement,d=l.querySelector(".com-dpcalendar-calendar__toggle");d&&d.addEventListener("click",function(){v.slideToggle(l.querySelector(".com-dpcalendar-calendar__list"),function(e){e?(l.querySelector('[data-direction="up"]').style.display="inline",l.querySelector('[data-direction="down"]').style.display="none"):(l.querySelector('[data-direction="up"]').style.display="none",l.querySelector('[data-direction="down"]').style.display="inline")})}),[].slice.call(c.parentElement.querySelectorAll(".com-dpcalendar-calendar__list .dp-input-checkbox")).forEach(function(t){u.calendarIds.forEach(function(e){e==t.value&&t.setAttribute("checked",!0)}),t.addEventListener("click",function(){var a=v.isLocalStorageSupported()?JSON.parse(localStorage.getItem(n)):[],r=t.value;t.checked?(c.dpCalendar.addEventSource({id:r,events:function(e,t,a){v.request(u.requestUrlRoot+"&ids="+r+"&date-start="+e.startStr+"&date-end="+e.endStr,function(e){t(e.data)})}}),a.push(r)):(c.dpCalendar.getEventSources().forEach(function(e){e.id==r&&e.remove()}),a.forEach(function(e,t){e==r&&a.splice(t,1)})),v.isLocalStorageSupported()&&localStorage.setItem(n,JSON.stringify(a))})})}}(document,window,Joomla,DPCalendar);
