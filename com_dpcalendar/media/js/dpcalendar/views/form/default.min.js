DPCalendar=window.DPCalendar||{},function(a,o,i){"use strict";function r(){var l=a.querySelector(".com-dpcalendar-eventform__overlapping");if(l){l.style.display="none";var e=new Url;i.request("task=event.overlapping",function(e){e.data.message&&(l.style.display="block",l.className="com-dpcalendar-eventform__overlapping dp-info-box"+(e.data.count?"":" dp-info-box_success"),l.innerHTML=e.data.message,l.getAttribute("data-overlapping")&&(a.querySelector(".dp-button-apply").disabled=0<e.data.count,a.querySelector(".dp-button-save").disabled=0<e.data.count,a.querySelector(".dp-button-save2new").disabled=0<e.data.count,a.querySelector(".dp-button-save2copy").disabled=0<e.data.count))},i.formToQueryString(a.querySelector(".com-dpcalendar-eventform__form"),"input:not([name=task]), select")+(e.query.e_id?"&id="+e.query.e_id:""))}}function c(){if(a.getElementById("jform_scheduling")){var e=a.getElementById("jform_rrule").value;if(e){var d=null;e.split(";").forEach(function(e){var l=e.split("=");if(0!==l.length)switch(l[0]){case"FREQ":[].slice.call(a.getElementById("jform_scheduling").querySelectorAll("input")).forEach(function(e){e.checked=e.value==l[1],e.value==l[1]&&(d=e.value),"DAILY"==l[1]&&(a.getElementById("jform_scheduling_daily_weekdays0").checked=!1,a.getElementById("jform_scheduling_daily_weekdays1").checked=!0)});break;case"BYDAY":"WEEKLY"==d&&"MO,TU,WE,TH,FR"==l[1]&&(a.getElementById("jform_scheduling_daily_weekdays0").checked=!0,a.getElementById("jform_scheduling_daily_weekdays1").checked=!1,a.getElementById("jform_scheduling1").checked=!0),l[1].split(",").forEach(function(e){if("MONTHLY"==d){var l=e.length,t=e.substring(l-2,l),n=e.substring(0,l-2);-1==n&&(n="last"),a.getElementById("jform_scheduling_monthly_week").querySelector('option[value="'+n+'"]').selected=!0,a.getElementById("jform_scheduling_monthly_week_days").querySelector('option[value="'+t+'"]').selected=!0}else a.getElementById("jform_scheduling_weekly_days").querySelector('option[value="'+e+'"]').selected=!0});break;case"BYMONTHDAY":a.getElementById("jform_scheduling_monthly_options").querySelector('input[value="by_day"]').checked=!0,l[1].split(",").forEach(function(e){a.getElementById("jform_scheduling_monthly_days").querySelector('option[value="'+e+'"]').selected=!0});break;case"COUNT":a.getElementById("jform_scheduling_repeat_count").value=l[1];break;case"INTERVAL":a.getElementById("jform_scheduling_interval").value=l[1];break;case"UNTIL":var t=a.getElementById("jform_scheduling_end_date");t.value=moment.utc(l[1]).format(t.getAttribute("format")),t.setAttribute("data-date",l[1].substr(0,8))}}),u()}else u()}else u()}function s(){if(a.getElementById("jform_scheduling")){var e,n="";if(a.getElementById("jform_scheduling1").checked&&(n="FREQ=DAILY",a.getElementById("jform_scheduling_daily_weekdays0").checked&&(n="FREQ=WEEKLY;BYDAY=MO,TU,WE,TH,FR")),a.getElementById("jform_scheduling2").checked)n="FREQ=WEEKLY",0<(e=[].slice.call(a.querySelectorAll("#jform_scheduling_weekly_days option:checked"))).length&&(n+=";BYDAY=",e.forEach(function(e){n+=e.value+","}),n=n.slice(0,-1));if(a.getElementById("jform_scheduling3").checked)if(n="FREQ=MONTHLY",a.getElementById("jform_scheduling_monthly_options0").checked)0<(e=[].slice.call(a.querySelectorAll("#jform_scheduling_monthly_days option:checked"))).length&&(n+=";BYMONTHDAY=",e.forEach(function(e){n+=e.value+","}),n=n.slice(0,-1));else 0<(e=[].slice.call(a.querySelectorAll("#jform_scheduling_monthly_week option:checked"))).length&&(n+=";BYDAY=",e.forEach(function(e){var l=[].slice.call(a.querySelectorAll("#jform_scheduling_monthly_week_days option:checked"));if(0!=l.length){var t=e.value;"last"==t&&(t=-1),l.forEach(function(e){n+=t+e.value+","})}}),n.endsWith(",")&&(n=n.slice(0,-1)));if(a.getElementById("jform_scheduling4").checked&&(n="FREQ=YEARLY"),1<n.length){var l=a.getElementById("jform_scheduling_interval").value;0<l&&(n+=";INTERVAL="+l);var t=a.getElementById("jform_scheduling_repeat_count").value;0<t&&(n+=";COUNT="+t);var d=a.getElementById("jform_scheduling_end_date"),o=moment(d.value,d.getAttribute("data-format"));o.isValid()&&(n+=";UNTIL="+o.format("YYYYMMDD")+"T235900Z")}a.getElementById("jform_rrule").value=n}}function y(){var n=a.querySelector(".com-dpcalendar-eventform__location .dp-map");null!=n&&null!=n.dpmap&&(n.dpmap.invalidateSize&&n.dpmap.invalidateSize(),i.Map.clearMarkers(n.dpmap),[].slice.call(a.querySelectorAll("#jform_location_ids option:checked")).forEach(function(e){var l=e.innerHTML,t=l.substring(l.lastIndexOf("[")+1,l.lastIndexOf("]")).split(":");t.length<2||0==t[0]&&0==t[1]||i.Map.createMarker(n.dpmap,{latitude:t[0],longitude:t[1],title:l})}))}function u(){if(!a.getElementById("jform_scheduling"))return a.querySelector(".dp-field-scheduling-end-date").style.display="none",a.querySelector(".dp-field-scheduling-interval").style.display="none",a.querySelector(".dp-field-scheduling-repeat-count").style.display="none",a.querySelector(".dp-field-rrule").style.display="none",a.querySelector(".dp-field-scheduling-daily-weekdays").style.display="none",a.querySelector(".dp-field-scheduling-weekly-days").style.display="none",a.querySelector(".dp-field-scheduling-monthly-options").style.display="none",a.querySelector(".dp-field-scheduling-monthly-week").style.display="none",a.querySelector(".dp-field-scheduling-monthly-week-days").style.display="none",void(a.querySelector(".dp-field-scheduling-monthly-days").style.display="none");a.getElementById("jform_scheduling0").checked?(a.querySelector(".dp-field-scheduling-end-date").style.display="none",a.querySelector(".dp-field-scheduling-interval").style.display="none",a.querySelector(".dp-field-scheduling-repeat-count").style.display="none",a.querySelector(".dp-field-rrule").style.display="none"):(a.querySelector(".dp-field-scheduling-end-date").style.display="block",a.querySelector(".dp-field-scheduling-interval").style.display="block",a.querySelector(".dp-field-scheduling-repeat-count").style.display="block",a.querySelector(".dp-field-rrule").style.display="block"),a.getElementById("jform_scheduling1").checked?a.querySelector(".dp-field-scheduling-daily-weekdays").style.display="block":a.querySelector(".dp-field-scheduling-daily-weekdays").style.display="none",a.getElementById("jform_scheduling2").checked?a.querySelector(".dp-field-scheduling-weekly-days").style.display="block":a.querySelector(".dp-field-scheduling-weekly-days").style.display="none",a.getElementById("jform_scheduling3").checked?(a.querySelector(".dp-field-scheduling-monthly-options").style.display="block",a.querySelector(".dp-field-scheduling-monthly-week").style.display="block",a.querySelector(".dp-field-scheduling-monthly-week-days").style.display="block",a.querySelector(".dp-field-scheduling-monthly-days").style.display="block",a.getElementById("jform_scheduling_monthly_options0").checked?(a.querySelector(".dp-field-scheduling-monthly-week").style.display="none",a.querySelector(".dp-field-scheduling-monthly-week-days").style.display="none",a.querySelector(".dp-field-scheduling-monthly-days").style.display="block"):(a.querySelector(".dp-field-scheduling-monthly-week").style.display="block",a.querySelector(".dp-field-scheduling-monthly-week-days").style.display="block",a.querySelector(".dp-field-scheduling-monthly-days").style.display="none")):(a.querySelector(".dp-field-scheduling-monthly-options").style.display="none",a.querySelector(".dp-field-scheduling-monthly-week").style.display="none",a.querySelector(".dp-field-scheduling-monthly-week-days").style.display="none",a.querySelector(".dp-field-scheduling-monthly-days").style.display="none")}a.addEventListener("DOMContentLoaded",function(){var e=a.getElementById("jform_rrule");if(e&&(e.addEventListener("change",function(e){c()}),[].slice.call(a.querySelectorAll(".dp-field-scheduling,#jform_scheduling_monthly_options,#jform_scheduling_daily_weekdays")).forEach(function(e){e.addEventListener("click",function(e){u(),s()})}),[].slice.call(a.querySelectorAll("#jform_scheduling_end_date, #jform_scheduling_interval, #jform_scheduling_repeat_count,#jform_scheduling_weekly_days, #jform_scheduling_monthly_days, #jform_scheduling_monthly_week_days, #jform_scheduling_monthly_week")).forEach(function(e){e.addEventListener("change",function(e){s()})}),c()),[].slice.call(a.querySelectorAll("#jform_all_day input")).forEach(function(e){e.addEventListener("click",function(e){0==this.value?(a.getElementById("jform_start_date_time").style.display="inline-block",a.getElementById("jform_end_date_time").style.display="inline-block"):(a.getElementById("jform_start_date_time").style.display="none",a.getElementById("jform_end_date_time").style.display="none"),r()})}),a.getElementById("jform_all_day0").checked||!a.getElementById("jform_all_day0").checked&&!a.getElementById("jform_all_day1").checked?(a.getElementById("jform_start_date_time").style.display="inline-block",a.getElementById("jform_end_date_time").style.display="inline-block"):(a.getElementById("jform_start_date_time").style.display="none",a.getElementById("jform_end_date_time").style.display="none"),[].slice.call(a.querySelectorAll("#jform_start_date, #jform_start_date_time, #jform_end_date, #jform_end_date_time, #jform_rooms")).forEach(function(e){e.addEventListener("change",function(e){setTimeout(r,2e3)})}),a.getElementById("jform_catid").addEventListener("change",function(e){for(var l=0;l<e.target.length;l++)if(e.target.value&&isNaN(parseInt(e.target.options[l].value)))return o.loadingLayer("show"),o.submitbutton("event.reload"),!0;setTimeout(r,2e3)}),setTimeout(r,2e3),setTimeout(y,2e3),o.JText._("COM_DPCALENDAR_ONLY_AVAILABLE_SUBSCRIBERS")&&[].slice.call(a.querySelectorAll(".dp-field-scheduling .controls, .dp-tabs__tab-booking .controls")).forEach(function(e){var l=a.createElement("span");l.className="dp-free-information-text",l.innerText=o.JText._("COM_DPCALENDAR_ONLY_AVAILABLE_SUBSCRIBERS"),e.appendChild(l)}),[].slice.call(a.querySelectorAll(".com-dpcalendar-eventform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(){o.submitbutton("event."+this.getAttribute("data-task"))})}),o.submitbutton=function(e){var l=a.getElementsByName("adminForm")[0];if(l&&(-1<e.indexOf("reload")||-1<e.indexOf("cancel")||-1<e.indexOf("delete")||a.formvalidator.isValid(l))){var t=o.JText._("COM_DPCALENDAR_VIEW_EVENT_SEND_TICKET_HOLDERS_NOFICATION");t&&(-1<e.indexOf("save")||-1<e.indexOf("apply"))&&confirm(t)&&(a.getElementById("jform_notify_changes").value=1),o.submitform(e,l)}},[].slice.call(a.querySelectorAll(".com-dpcalendar-eventform select:not(#jform_color)")).forEach(function(e){e._choicejs=new Choices(e,{itemSelectText:"",noChoicesText:"",shouldSortItems:!1,shouldSort:!1,removeItemButton:"jform_catid"!=e.id})}),0==parseInt(a.getElementById("jform_id").value)){var l=a.getElementById("jform_title");i.autocomplete.create(l),l.addEventListener("dp-autocomplete-select",function(e){a.querySelector("input[name=template_event_id]").value=e.detail.value,o.submitbutton("event.reloadfromevent")});var t=new Url;l.addEventListener("dp-autocomplete-change",function(e){i.request("task=event.similar",function(e){i.autocomplete.setItems(l,e.data)},i.formToQueryString(a.querySelector(".com-dpcalendar-eventform__form"),"input:not([name=task]), select")+"&id="+t.query.e_id)})}if(a.querySelector(".com-dpcalendar-eventform__location")){a.getElementById("jform_location_ids").addEventListener("change",function(e){if(!a.getElementById("jform_rooms"))return!0;o.loadingLayer("show"),o.submitbutton("event.reload")}),a.querySelector(".com-dpcalendar-eventform__location-form .dp-button-cancel").addEventListener("click",function(){var e=a.createEvent("CustomEvent");e.initCustomEvent("click"),a.querySelector(".com-dpcalendar-eventform__toggle").dispatchEvent(e)}),a.querySelector(".com-dpcalendar-eventform__location-form .dp-button-save").addEventListener("click",function(){var e=function(e,l){var t=a.getElementById("location_"+l);t&&(e.jform[l]=t.value)},l=[];l.jform=[],e(l,"title"),e(l,"country"),e(l,"province"),e(l,"city"),e(l,"zip"),e(l,"street"),e(l,"number"),l.jform.state=1,l.jform.language="*",l[a.querySelector('[name="location_token"]').value]="1",l.ajax="1",l.id=0,i.request("task=locationform.save",function(e){null!=e.data.id&&null!=e.data.display&&(a.getElementById("jform_location_ids")._choicejs.setChoices([{value:e.data.id,label:e.data.display,selected:!0}],"value","label"),y(),[].slice.call(a.querySelectorAll(".com-dpcalendar-eventform__location-form input")).forEach(function(e){e.value=""}))},i.arrayToQueryString(l))});var n=a.querySelector(".com-dpcalendar-eventform__toggle");n&&n.addEventListener("click",function(){i.slideToggle(a.querySelector(".com-dpcalendar-eventform__location-form"),function(e){var l=a.querySelector(".com-dpcalendar-eventform__toggle");l.querySelector('[data-direction="down"]').style.display=e?(l.querySelector('[data-direction="up"]').style.display="inline","none"):(l.querySelector('[data-direction="up"]').style.display="none","inline")})}),[].slice.call(a.querySelectorAll(".com-dpcalendar-eventform__location-form input")).forEach(function(e){e.classList.add("novalidate")});var d=a.querySelector(".com-dpcalendar-eventform .dp-field-rooms");d&&0==d.querySelectorAll(".choices__item[data-value]").length&&(d.style.display="none")}})}(document,Joomla,DPCalendar);
