DPCalendar=window.DPCalendar||{},function(p,o,l){"use strict";l.Map={},l.Map.create=function(a){if("undefined"!=typeof L){a.classList.add("dp-map_loading");var e=a.dataset,t=L.map(a,{attributionControl:!0,fullscreenControl:!0,gestureHandling:!0,gestureHandlingOptions:{duration:2e3,text:{touch:o.JText._("COM_DPCALENDAR_LEAFLET_TEXT_TOUCH"),scroll:o.JText._("COM_DPCALENDAR_LEAFLET_TEXT_SCROLL"),scrollMac:o.JText._("COM_DPCALENDAR_LEAFLET_TEXT_SCROLLMAC")}}}).setView([e.latitude?e.latitude:47,e.longitude?e.longitude:4],e.zoom?e.zoom:4);if(t.attributionControl.setPrefix(""),t.attributionControl.addAttribution(o.getOptions("DPCalendar.map.tiles.attribution")),"google"==o.getOptions("DPCalendar.map.tiles.url")){var d=google.maps.MapTypeId.ROADMAP;switch(e.type){case 2:d=google.maps.MapTypeId.SATELLITE;break;case 3:d=google.maps.MapTypeId.HYBRID;break;case 4:d=google.maps.MapTypeId.TERRAIN}(n=L.gridLayer.googleMutant({type:d})).addTo(t),n.addEventListener("spawned",function(e){google.maps.event.addListenerOnce(e.mapObject,"idle",function(){a.classList.remove("dp-map_loading"),a.classList.add("dp-map_loaded")})})}else{var n;(n=L.tileLayer(o.getOptions("DPCalendar.map.tiles.url"),{id:"mapbox.streets"})).on("load",function(){a.classList.remove("dp-map_loading"),a.classList.add("dp-map_loaded")}),n.addTo(t)}t.dpMarkersCluster=L.markerClusterGroup(),t.addLayer(t.dpMarkersCluster),t.dpBounds=new L.latLngBounds,t.dpMarkers=[],(t.dpElement=a).dpmap=t;var r=p.createEvent("CustomEvent");return r.initCustomEvent("dp-map-loaded"),a.dispatchEvent(r),Array.isArray(a.dpCachedMarkers)&&(a.dpCachedMarkers.forEach(function(e){l.Map.createMarker(a,e.data,e.dragCallback)}),a.dpCachedMarkers=null),t}},l.Map.createMarker=function(e,a,t){var d=a.latitude,n=a.longitude;if(null!=d&&""!=d){if(null==e.dpmap)return null==e.dpCachedMarkers&&(e.dpCachedMarkers=[]),void e.dpCachedMarkers.push({data:a,dragCallback:t});a.color||(a.color="000000");var r={draggable:null!=t};r.icon=L.divIcon({className:"dp-location-marker",html:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path fill="#'+String(a.color).replace("#","")+'" d="M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"/></svg>',iconSize:[25,30],iconAnchor:[10,35]});var p=L.marker([d,n],r),o=a.description?a.description:a.title;if(o){var l=p.bindPopup(o);p.on("click",function(){l.openPopup()})}return t&&p.on("dragend",function(e){t(e.target.getLatLng().lat,e.target.getLatLng().lng)}),e.dpmap.dpMarkersCluster.addLayer(p),e.dpmap.dpMarkers.push(p),e.dpmap.dpBounds.extend(p.getLatLng()),e.dpmap.panTo(e.dpmap.dpBounds.getCenter()),p}},l.Map.clearMarkers=function(a){if(null!=a&&null!=a.dpmap&&null!=a.dpmap.dpMarkers){a.dpmap.dpMarkers.forEach(function(e){a.dpmap.dpMarkersCluster.removeLayer(e)}),a.dpmap.dpMarkers=[],a.dpmap.dpCachedMarkers=[],a.dpmap.dpBounds=new L.latLngBounds;var e=a.dpmap.dpElement.dataset;a.dpmap.panTo([e.latitude?e.latitude:47,e.longitude?e.longitude:4])}},l.Map.moveMarker=function(e,a,t,d){a&&null!=e.dpmap&&(a.setLatLng([t,d]),e.dpmap.dpBounds=new L.latLngBounds,e.dpmap.dpMarkers.forEach(function(){e.dpmap.dpBounds.extend(a.getLatLng())}),e.dpmap.panTo(e.dpmap.dpBounds.getCenter()))},l.Map.drawCircle=function(e,a,t,d){null!=e.dpmap&&("mile"==d&&(t*=1.60934),e.dpmap.dpMarkers.push(L.circle([a.latitude,a.longitude],1e3*t).addTo(e.dpmap)),e.dpmap.dpMarkers.push(L.circleMarker([a.latitude,a.longitude],{radius:10,color:"#000000",fillColor:"#000000",fillOpacity:1}).addTo(e.dpmap)),e.dpmap.panTo([a.latitude,a.longitude]))},p.addEventListener("DOMContentLoaded",function(){function d(d){var e=d.dataset;e.width&&(d.style.width=e.width),e.height&&(d.style.height=e.height),l.Map.create(d);var a=d.closest(".dp-location");null==a&&(a=d.closest(".dp-locations")),null!=a&&[].slice.call(a.querySelectorAll(".dp-location__details")).forEach(function(e){var a=e.dataset,t=e.parentElement.querySelector(".dp-location__description");!a.description&&t&&(a.description=t.innerHTML),l.Map.createMarker(d,a)})}[].slice.call(p.querySelectorAll(".dp-map")).forEach(function(t){null!=l.Map&&("IntersectionObserver"in window?new IntersectionObserver(function(e,a){e.forEach(function(e){e.isIntersecting&&(a.unobserve(t),d(t))})}).observe(t):d(t))})})}(document,Joomla,DPCalendar);
