DPCalendar=window.DPCalendar||{},function(a,i,c){"use strict";function o(){var e=a.querySelector(".com-dpcalendar-bookingform .dp-button-save");if(e&&(e.disabled=!1),i.getOptions("DPCalendar.price.url")&&a.querySelector(".dp-price-total__content")){[].slice.call(a.querySelectorAll(".com-dpcalendar-bookingform .dp-event")).forEach(function(t){var r=0,e=[].slice.call(t.querySelectorAll(".dp-ticket__amount .dp-select"));e.forEach(function(e){r+=parseInt(e.options[e.selectedIndex].value)}),e.forEach(function(e){r>t.getAttribute("data-ticket-count")&&0<parseInt(e.options[e.selectedIndex].value)?e.classList.add("dp-select_error"):e.classList.remove("dp-select_error")})});var t=a.querySelector(".com-dpcalendar-bookingform .dp-tax");if(0<a.querySelectorAll(".com-dpcalendar-bookingform .dp-ticket__amount .dp-select_error").length)return a.querySelector(".com-dpcalendar-bookingform .dp-price-total__content").innerHTML="",i.renderMessages({error:[i.JText._("COM_DPCALENDAR_VIEW_BOOKINGFORM_TICKETS_OVERBOOKED_MESSAGE")]}),e.disabled=!0,void(t&&(t.style.display="none"));var r=a.querySelector(".com-dpcalendar-bookingform__form"),o=c.formToQueryString(r,'input:not([name="task"]), select');c.request(i.getOptions("DPCalendar.price.url"),function(p){var s=i.JText._("COM_DPCALENDAR_VIEW_BOOKINGFORM_TAX_"+(1==p.data.taxinclusive?"IN":"EX")+"CLUSIVE_TEXT"),u=i.JText._("COM_DPCALENDAR_VIEW_BOOKINGFORM_DISCOUNT");Object.keys(p.data.events).map(function(l){var d=r.querySelector('[data-event-id="'+l+'"]');Object.keys(p.data.events[l]).map(function(c){Object.keys(p.data.events[l][c]).map(function(e){var t=p.data.events[l][c][e],r=c.substring(0,c.length-1),o=d.querySelector("[data-"+r+'-price="'+e+'"]');if(o){var n=o.querySelector(".dp-price__live");if(n){var a=o.querySelector(".dp-price__info"),i="";n.innerHTML=t.discount,t.discount!=t.original?(o.querySelector(".dp-price__live").classList.remove("dp-price_hidden"),o.querySelector(".dp-price__original").classList.remove("dp-price_hidden"),o.querySelector(".dp-price__original").innerHTML=t.original,i=u):(o.querySelector(".dp-price__original").classList.add("dp-price_hidden"),a&&a.classList.add("dp-price_hidden")),p.data.tax&&"0.00"!=t.raw&&(i+=(i?"<br>":"")+s),a&&i&&(a.classList.remove("dp-price_hidden"),tippy(a,{interactive:!0,delay:100,arrow:!0,content:i,ignoreAttributes:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}}))}}})})}),a.querySelector(".com-dpcalendar-bookingform .dp-price-total__content").innerHTML=p.data.total,a.querySelector(".com-dpcalendar-bookingform .dp-price-total__content").setAttribute("data-raw",p.data.totalraw);var e=a.querySelector(".com-dpcalendar-bookingform .dp-tax");p.data.tax?(e.style.display="inline-block",e.querySelector(".dp-tax__content").innerHTML=p.data.tax,e.querySelector(".dp-tax__title").innerHTML="("+p.data.taxtitle+")",tippy(e.querySelector(".dp-tax__icon"),{interactive:!0,delay:100,arrow:!0,content:s,ignoreAttributes:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}})):e.style.display="none"},o)}}a.addEventListener("DOMContentLoaded",function(){o(),[].slice.call(a.querySelectorAll(".dp-booking-series__input input")).forEach(function(e){e.addEventListener("click",function(){var t=a.getElementById("jform_series0").checked;[].slice.call(a.querySelectorAll(".com-dpcalendar-bookingform__events .dp-event_instance")).forEach(function(e){e.style.display=t?"inherit":"none",e.querySelector("select").value=t?"1":"0"}),o()})}),[].slice.call(a.querySelectorAll(".dp-ticket__amount .dp-select, .dp-option__amount .dp-select, .dp-field-country .dp-select")).forEach(function(e){e.addEventListener("change",function(){o()})});var r=[].slice.call(a.querySelectorAll(".com-dpcalendar-bookingform__fields .dp-input-terms"));r.forEach(function(e){e.addEventListener("change",function(){var t=!0;r.forEach(function(e){e.checked||(t=!1)}),a.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!t})}),r.length&&(a.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!0),[].slice.call(a.querySelectorAll(".com-dpcalendar-bookingform__actions .dp-button")).forEach(function(n){n.addEventListener("click",function(e){e.preventDefault();var t=a.querySelectorAll(".dp-payment-option");"save"==n.getAttribute("data-task")&&1==t.length&&(t[0].querySelector(".dp-payment-option__input").checked=!0);var r=a.querySelector(".dp-price-total__content");if("save"==n.getAttribute("data-task")&&0<t.length&&r&&0==r.getAttribute("data-raw")&&(t[0].querySelector(".dp-payment-option__input").checked=!0),"save"==n.getAttribute("data-task")&&1<t.length&&!a.querySelectorAll(".dp-payment-option__input:checked").length){var o=a.getElementsByName("adminForm")[0];return o&&!a.formvalidator.isValid(o)||(c.slideToggle(a.querySelector(".com-dpcalendar-bookingform__payment-options")),[].slice.call(a.querySelectorAll(".dp-payment-option")).forEach(function(e){e.addEventListener("click",function(){e.querySelector(".dp-payment-option__input").checked=!0,i.submitbutton("bookingform.save")})})),!1}return i.submitbutton("bookingform."+n.getAttribute("data-task")),!1})}),i.submitbutton=function(e){var t=a.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||a.formvalidator.isValid(t))&&i.submitform(e,t)},[].slice.call(a.querySelectorAll(".com-dpcalendar-bookingform .dp-field-country .dp-select")).forEach(function(e){e._choicejs=new Choices(e,{itemSelectText:"",noChoicesText:"",shouldSortItems:!1,shouldSort:!1,searchResultLimit:30})})}),c.updateBookingMail=function(e){c.request("task=booking.mail",function(e){e.success&&(a.getElementById("jform_name").value=e.data.name,a.getElementById("jform_email").value=e.data.email)},"ajax=1&id="+a.getElementById("jform_user_id_id").value)}}(document,Joomla,DPCalendar);