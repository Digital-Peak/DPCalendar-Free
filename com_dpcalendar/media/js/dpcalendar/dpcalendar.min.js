DPCalendar=window.DPCalendar||{},function(i,a,l){"use strict";l.requestCounter=0,l.modal=function(e,t,o,n){var r=new tingle.modal({footer:!1,stickyFooter:!1,closeMethods:["overlay","button","escape"],cssClass:["dpcalendar-modal"],closeLabel:a.JText._("COM_DPCALENDAR_CLOSE","Close"),onClose:function(){n&&n(r.modalBox.children[0].querySelector("iframe"))}});t&&i.body.clientWidth>t&&(isNaN(t)||(t+="px"),i.querySelector(".tingle-modal-box").style.width=t),isNaN(o)||(o+="px"),r.setContent('<iframe width="100%" height="'+o+'" src="'+e.toString()+'" frameborder="0" allowfullscreen></iframe>'),r.open()},l.print=function(e){i.body.outerHTML=i.querySelector(e).outerHTML,window.print(),setInterval(function(){window.location.reload(!1)},1e3)},l.slideToggle=function(e,t){if(e){if(!e.getAttribute("data-max-height")){var o=window.getComputedStyle(e),n=o.display,r=o.position,i=o.visibility,a=e.offsetHeight;if("none"===n){e.style.visibility="hidden",e.style.display="block",a=e.offsetHeight;var l=window.getComputedStyle(e);a+=parseFloat(l.getPropertyValue("margin-top"))+parseFloat(l.marginBottom),e.style.display=n,e.style.position=r,e.style.visibility=i}e.style.maxHeight&&e.style.maxHeight<a&&(a=e.style.maxHeight,e.style.overflowY="auto"),e.style.transition="max-height 0.5s ease-in-out",e.style.overflowX="hidden",e.style.overflowY="hidden",e.style.maxHeight="none"===n?"0px":a+"px",e.style.display="block",e.setAttribute("data-max-height",a+"px")}var s="0"===e.style.maxHeight.replace("px","").replace("%","");t&&e.addEventListener("transitionend",function(){t(s)},{once:!0}),setTimeout(function(){e.style.maxHeight=s?e.getAttribute("data-max-height"):"0"},1)}},l.encode=function(e){return e.replace(/&amp;/g,"&")},l.pad=function(e,t){for(var o=e+"";o.length<t;)o="0"+o;return o},l.isLocalStorageSupported=function(){var e="test";try{return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}},l.formToQueryString=function(e,t){for(var o,n=t?e.querySelectorAll(t):e.elements,r=[],i=0;i<n.length;i++)if((o=n[i]).name&&!o.disabled&&"file"!=o.type&&"reset"!=o.type&&"submit"!=o.type&&"button"!=o.type)if("select-multiple"==o.type)for(var a=n[i].options.length-1;0<=a;a--)o.options[a].selected&&(r[r.length]=encodeURIComponent(o.name)+"="+encodeURIComponent(o.options[a].value));else("checkbox"!=o.type&&"radio"!=o.type||o.checked)&&(r[r.length]=encodeURIComponent(o.name)+"="+encodeURIComponent(o.value));return r.join("&").replace(/%20/g,"+")},l.arrayToQueryString=function(e,t){var o,n=[];for(o in e)if(e.hasOwnProperty(o)){var r=t?t+"["+o+"]":o,i=e[o];n.push(null!==i&&"object"==typeof i?l.arrayToQueryString(i,r):encodeURIComponent(r)+"="+encodeURIComponent(i))}return n.join("&").replace(/%20/g,"+")},l.currentLocation=function(o){return!!navigator.geolocation&&(navigator.geolocation.getCurrentPosition(function(e){var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),l.request("task="+t+"&loc="+encodeURIComponent(e.coords.latitude+","+e.coords.longitude),function(e){o(e.data.formated)})},function(e){a.renderMessages({error:[e.message]})}),!0)},l.request=function(e,o,t){var n=i.querySelector(".dp-loader");n&&n.classList.remove("dp-loader_hidden"),t||(t=""),t+=(t?"&":"")+a.getOptions("csrf.token")+"=1",l.requestCounter++,a.request({url:a.getOptions("system.paths").base+"/index.php?option=com_dpcalendar&"+e,method:"POST",data:t,onSuccess:function(e){l.requestCounter--,n&&n.classList.add("dp-loader_hidden");var t=JSON.parse(e);null!=t.messages&&0!==t.messages.length&&i.getElementById("system-message-container")&&a.renderMessages(t.messages),o&&o(t)},onError:function(e){l.requestCounter--,n&&n.classList.add("dp-loader_hidden");var t=JSON.parse(e);null!=t.messages&&0!==t.messages.length&&i.getElementById("system-message-container")&&a.renderMessages(t.messages)}})},l.debounce=function(n,r,i){var a;return null==r&&(r=500),null==i&&(i=!1),function(){var e=this,t=arguments,o=i&&!a;clearTimeout(a),a=setTimeout(function(){a=null,i||n.apply(e,t)},r),o&&n.apply(e,t)}},i.addEventListener("DOMContentLoaded",function(){[].slice.call(i.querySelectorAll(".dp-button-print")).forEach(function(e){e.addEventListener("click",function(){l.print(e.getAttribute("data-selector"))})}),[].slice.call(i.querySelectorAll(".dp-button-action[data-href]")).forEach(function(e){e.addEventListener("click",function(){return"new"==this.getAttribute("data-target")?window.open(this.getAttribute("data-href")):location.href=this.getAttribute("data-href"),!1})});var e=i.querySelector(".dp-timezone .dp-select");e&&("undefined"!=typeof Choices&&new Choices(e,{itemSelectText:"",noChoicesText:"",shouldSortItems:!1,shouldSort:!1}),e.addEventListener("change",function(){this.form.submit()})),l.isLocalStorageSupported()&&[].slice.call(i.querySelectorAll(".dp-tabs__input")).forEach(function(e){e.addEventListener("click",function(){localStorage.setItem("dp-tabs-"+this.name,this.id)}),localStorage.getItem("dp-tabs-"+e.name)==e.id&&(e.checked=!0)});function n(n){var e=n.dataset;e.width&&(n.style.width=e.width),e.height&&(n.style.height=e.height),l.Map.create(n);var t=n.closest(".dp-location");null==t&&(t=n.closest(".dp-locations")),null!=t&&[].slice.call(t.querySelectorAll(".dp-location__details")).forEach(function(e){var t=e.dataset,o=e.parentElement.querySelector(".dp-location__description");!t.description&&o&&(t.description=o.innerHTML),l.Map.createMarker(n,t)})}[].slice.call(i.querySelectorAll(".dp-map")).forEach(function(o){null!=l.Map&&("IntersectionObserver"in window&&"false"!=o.getAttribute("data-lazy")?new IntersectionObserver(function(e,t){e.forEach(function(e){e.isIntersecting&&(t.unobserve(o),n(o))})}).observe(o):n(o))})})}(document,Joomla,DPCalendar);
