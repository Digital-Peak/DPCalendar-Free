DPCalendar=window.DPCalendar||{},function(_,m,s,p,a){"use strict";_.addEventListener("DOMContentLoaded",function(){[].slice.call(_.querySelectorAll(".dp-calendar")).forEach(function(e){if(e.getAttribute("data-options")){var t=s.getOptions(e.getAttribute("data-options"));p.createCalendar(a(e),t)}})}),p.createCalendar=function(c,u){var n=function(e){e||(e=c.fullCalendar("getDate"));var t=c[0].querySelector('th[data-date^="'+e.format("YYYY-MM-DD")+'"]');if(t){var a=c[0].querySelector(".fc-time-area .fc-scroller");if(a){a.scrollLeft=0;var r=a.getBoundingClientRect(),n=t.getBoundingClientRect();a.scrollLeft=n.left+n.width/2-r.left-r.width/2}}};if(c[0].parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden"),u.use_hash){for(var e=m.location.hash.replace(/&amp;/gi,"&").split("&"),t=0;t<e.length;t++)e[t].match("^#year")&&(u.year=e[t].substring(6)),e[t].match("^month")&&(u.month=e[t].substring(6)),e[t].match("^day")&&(u.date=e[t].substring(4)),e[t].match("^view")&&(u.defaultView=e[t].substring(5));m.addEventListener("hashchange",function(){for(var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,r=e.getDate(),n=u.defaultView,l=m.location.hash.replace(/&amp;/gi,"&").split("&"),o=0;o<l.length;o++)l[o].match("^#year")&&(t=l[o].substring(6)),l[o].match("^month")&&(a=l[o].substring(6)-1),l[o].match("^day")&&(r=l[o].substring(4)),l[o].match("^view")&&(n=l[o].substring(5));var i=new Date(t,a,r,0,0,0),d=c.fullCalendar("getDate"),s=c.fullCalendar("getView");i.getYear()==d.year()&&i.month()==d.month()&&i.date()==d.date()||c.fullCalendar("gotoDate",i),s.name!=n&&c.fullCalendar("changeView",n)})}u.defaultDate=moment(u.year+"-"+p.pad(parseInt(u.month),2)+"-"+p.pad(u.date,2)),_.body.clientWidth<u.screen_size_list_view&&(u.defaultView="list"),u.schedulerLicenseKey="GPL-My-Project-Is-Open-Source",u.weekNumberTitle="",u.theme=!1,u.startParam="date-start",u.endParam="date-end",u.eventLimitText=s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_MORE"),u.allDayText=s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_ALL_DAY"),u.buttonText={today:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_TODAY"),year:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_YEAR"),month:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_MONTH"),week:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_WEEK"),day:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_DAY"),list:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_LIST")},u.listTexts={until:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_UNTIL"),past:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_PAST"),today:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TODAY"),tomorrow:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TOMORROW"),thisWeek:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_WEEK"),nextWeek:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_WEEK"),thisMonth:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_MONTH"),nextMonth:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_MONTH"),future:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_FUTURE"),week:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_WEEK")},u.viewRender=function(e){var t=c.fullCalendar("getDate"),a="year="+t.year()+"&month="+(t.month()+1)+"&day="+t.date()+"&view="+e.name;u.use_hash&&m.location.hash.replace(/&amp;/gi,"&")!=a&&(m.location.hash=a),n();var r=c[0].parentElement.querySelector(".dp-map");null!=r&&null!=r.dpmap&&u.show_map&&p.Map.clearMarkers(r.dpmap)},u.eventRender=function(e,t,a){var r=t.find(".fc-title");r.html(r.text());var n=t[0];if(e.view_class&&n.classList.add(e.view_class),e.description){s=(s=(s=e.description).replace("task=event.delete","task=event.delete&urlhash="+encodeURIComponent(m.location.hash))).replace("task=event.edit","task=event.edit&urlhash="+encodeURIComponent(m.location.hash));var l=_.createElement("div");l.innerHTML=s,tippy(n,{interactive:!0,delay:100,arrow:!0,html:l,flipDuration:0,performance:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}})}e.fgcolor&&"list"!=a.name&&(n.style.color=e.fgcolor);var o=c[0].parentElement.querySelector(".dp-map");if(null!=o&&null!=o.dpmap&&u.show_map)for(var i=0;i<e.location.length;i++){var d=JSON.parse(JSON.stringify(e.location[i]));d.title=e.title,d.color=e.color;var s=e.description;e.url&&(s=s.replace(e.title,'<a href="'+e.url+'">'+e.title+"</a>")),d.description=s,p.Map.createMarker(o.dpmap,d)}},u.eventDataTransform=function(e){if(e.allDay){var t=moment(e.end);t.add(1,"day"),e.end=t}return e},u.eventDrop=function(a,e,r,t,n,l){if(a.resourceId)return r(),!1;p.request("task=event.move",function(e){if(e.data.url&&(a.url=e.data.url),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void r()}else r();else r()},"id="+a.id+"&minutes="+e.asMinutes()+"&allDay="+!a.start.hasTime())},u.eventResize=function(a,e,r,t,n,l){p.request("task=event.move",function(e){if(e.data.url&&(a.url=e.data.url),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void r()}else r();else r()},"id="+a.id+"&minutes="+e.asMinutes()+"&onlyEnd=1&allDay="+!a.start.hasTime())},u.eventClick=function(e,t,a){if(t.stopPropagation(),t.currentTarget._tippy&&t.currentTarget._tippy.hide(),2==u.show_event_as_popup)return!1;if(1==u.show_event_as_popup){var r=new Url(e.url);r.query.tmpl="component",p.modal(r,c.data("popupwidth"),c.data("popupheight"),function(e){(e.contentDocument||e.contentWindow.document).getElementById("system-message-container").children.length<1||c.fullCalendar("refetchEvents")})}else m.location=p.encode(e.url);return!1},u.dayClick=function(e,t,a,r){var n=c[0].parentElement.querySelector(".dp-quickadd .dp-form");if(n){t.stopPropagation(),"month"==a.name&&(e.hours(8),e.minutes(0));var l=n.querySelector("#jform_start_date");l.value=e.format(l.getAttribute("data-format")),l.actualDate=l.value,(l=n.querySelector("#jform_start_date_time")).value=e.format(l.getAttribute("data-format")),l.actualDate=l.value,e.add("hours",1);var o=n.querySelector("#jform_end_date");if(o.value=e.format(o.getAttribute("data-format")),o.actualDate=o.value,(o=n.querySelector("#jform_end_date_time")).value=e.format(o.getAttribute("data-format")),o.actualDate=o.value,r){var i=r.id.split("-");n.querySelector('input[name="jform[location_ids][]"]').value=[i[0]],1<i.length&&(n.querySelector('input[name="jform[rooms][]"]').value=[r.id])}1==u.event_create_form&&600<m.innerWidth?(new Popper(t.target,n.parentElement,{onCreate:function(e){e.instance.popper.querySelector("#jform_title").focus()}}),n.parentElement.style.display="block"):(n.querySelector("input[name=task]").value="",n.submit())}else 0<u.header.right.indexOf("agendaDay")&&(c.fullCalendar("gotoDate",e),c.fullCalendar("changeView","agendaDay"))},u.customButtons={},u.header.left.indexOf("datepicker")&&(u.customButtons.datepicker={text:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_SHOW_DATEPICKER"),icon:"icon-calendar",click:function(){var e=_.querySelector(".fc-datepicker-button"),t=_.getElementById(c.attr("id")+"-datepicker-input");t||((t=_.createElement("input")).setAttribute("type","hidden"),t.id=c.attr("id")+"-datepicker-input",e.appendChild(t));var r=new Pikaday({field:t,trigger:e,i18n:{months:u.monthNames,weekdays:u.dayNames,weekdaysShort:u.dayNamesShort},onSelect:function(e){var t=r.getMoment(),a="year="+t.year()+"&month="+(t.month()+1)+"&day="+t.date()+"&view="+c.fullCalendar("getView").name;u.use_hash&&m.location.hash.replace(/&amp;/gi,"&")!=a?m.location.hash=a:c.fullCalendar("gotoDate",t),n(t),this.destroy()}});r.show()}}),u.header.left.indexOf("print")&&(u.customButtons.print={text:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-print",click:function(){var e=_.location.href.replace(/\?/,"?layout=print&tmpl=component&");e==_.location.href&&(e=_.location.href.replace(/#/,"?layout=print&tmpl=component#")),m.open(e).focus()}}),u.header.left.indexOf("add")&&u.event_create_url&&(u.customButtons.add={text:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-add",click:function(){location.href=u.event_create_url}}),u.loading=function(e){e?c[0].parentElement.parentElement.querySelector(".dp-loader").classList.remove("dp-loader_hidden"):c[0].parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden")},c.data("eventSources",u.eventSources);var a=md5(JSON.stringify(u.eventSources));p.isLocalStorageSupported()&&(null==localStorage.getItem(c.attr("id")+a)?localStorage.setItem(c.attr("id")+a,JSON.stringify(u.eventSources)):u.eventSources=JSON.parse(localStorage.getItem(c.attr("id")+a)));var r=[];for(t=0;t<u.eventSources.length;t++)r.push({url:u.eventSources[t],success:p.extractEvents});u.eventSources=r,moment.updateLocale("en",{months:u.dayNames,monthsShort:u.monthNamesShort,weekdays:u.dayNames,weekdaysShort:u.dayNamesShort,weekdaysMin:u.dayNamesMin}),c.fullCalendar(u),n();var l=c[0].parentElement,o=l.querySelector(".com-dpcalendar-calendar__toggle");o&&o.addEventListener("click",function(){p.slideToggle(l.querySelector(".com-dpcalendar-calendar__list"),function(e){e?(l.querySelector('[data-direction="up"]').style.display="inline",l.querySelector('[data-direction="down"]').style.display="none"):(l.querySelector('[data-direction="up"]').style.display="none",l.querySelector('[data-direction="down"]').style.display="inline")})});for(var i=c[0].parentElement.querySelectorAll(".com-dpcalendar-calendar__list .dp-input-checkbox"),d=0;d<i.length;d++){for(t=0;t<u.eventSources.length;t++)u.eventSources[t].url==i[d].value&&i[d].setAttribute("checked",!0);i[d].addEventListener("click",function(){p.updateCalendar(this,c)})}},p.updateCalendar=function(e,t){var a=md5(JSON.stringify(t.data("eventSources"))),r=p.isLocalStorageSupported()?JSON.parse(localStorage.getItem(t.attr("id")+a)):[],n={url:e.value,success:p.extractEvents};if(e.checked)t.fullCalendar("addEventSource",n),r.push(n.url);else{t.fullCalendar("removeEventSource",n);for(var l=0;l<r.length;l++)r[l]==n.url&&r.splice(l,1)}p.isLocalStorageSupported()&&localStorage.setItem(t.attr("id")+a,JSON.stringify(r))},p.extractEvents=function(e){return e.length&&null!=e[0].messages&&_.getElementById("system-message-container")&&s.renderMessages(e[0].messages),e.length&&null!=e[0].data?e[0].data:e}}(document,window,Joomla,DPCalendar,jQuery);
