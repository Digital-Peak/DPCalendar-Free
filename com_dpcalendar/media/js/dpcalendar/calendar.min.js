DPCalendar=window.DPCalendar||{},function(_,m,s,p,a){"use strict";_.addEventListener("DOMContentLoaded",function(){[].slice.call(_.querySelectorAll(".dp-calendar")).forEach(function(e){if(e.getAttribute("data-options")){var t=s.getOptions(e.getAttribute("data-options"));"string"==typeof(t=Object.assign(t,e.dataset)).hiddenDays&&(t.hiddenDays=JSON.parse(t.hiddenDays)),p.createCalendar(a(e),t)}})}),p.createCalendar=function(c,u){if(c[0].parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden"),u.use_hash){for(var e=m.location.hash.replace(/&amp;/gi,"&").split("&"),t=0;t<e.length;t++)e[t].match("^#year")&&(u.year=e[t].substring(6)),e[t].match("^month")&&(u.month=e[t].substring(6)),e[t].match("^day")&&(u.date=e[t].substring(4)),e[t].match("^view")&&(u.defaultView=e[t].substring(5));m.addEventListener("hashchange",function(){for(var e=new Date,t=e.getFullYear(),a=e.getMonth()+1,n=e.getDate(),r=u.defaultView,o=m.location.hash.replace(/&amp;/gi,"&").split("&"),l=0;l<o.length;l++)o[l].match("^#year")&&(t=o[l].substring(6)),o[l].match("^month")&&(a=o[l].substring(6)-1),o[l].match("^day")&&(n=o[l].substring(4)),o[l].match("^view")&&(r=o[l].substring(5));var i=new Date(t,a,n,0,0,0),s=c.fullCalendar("getDate"),d=c.fullCalendar("getView");i.getYear()==s.year()&&i.month()==s.month()&&i.date()==s.date()||c.fullCalendar("gotoDate",i),d.name!=r&&c.fullCalendar("changeView",r)})}u.defaultDate=moment(u.year+"-"+p.pad(parseInt(u.month),2)+"-"+p.pad(u.date,2)),_.body.clientWidth<u.screen_size_list_view&&(u.defaultView="list"),u.schedulerLicenseKey="GPL-My-Project-Is-Open-Source",u.weekNumberTitle="",u.theme=!1,u.startParam="date-start",u.endParam="date-end",u.eventLimitText=s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_MORE"),u.allDayText=s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_ALL_DAY"),u.buttonText={today:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_TODAY"),year:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_YEAR"),month:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_MONTH"),week:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_WEEK"),day:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_DAY"),list:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_LIST")},u.listTexts={until:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_UNTIL"),past:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_PAST"),today:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TODAY"),tomorrow:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TOMORROW"),thisWeek:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_WEEK"),nextWeek:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_WEEK"),thisMonth:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_MONTH"),nextMonth:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_MONTH"),future:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_FUTURE"),week:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_WEEK")},u.viewRender=function(e){var t=c.fullCalendar("getDate"),a="year="+t.year()+"&month="+(t.month()+1)+"&day="+t.date()+"&view="+e.name;u.use_hash&&m.location.hash.replace(/&amp;/gi,"&")!=a&&(m.location.hash=a);var n=c[0].parentElement.querySelector(".dp-map");null!=n&&null!=n.dpmap&&u.show_map&&p.Map.clearMarkers(n.dpmap)},u.eventRender=function(e,t,a){var n=t.find(".fc-title");n.html(n.text());var r=t[0];if(e.view_class&&r.classList.add(e.view_class),e.description){d=(d=(d=e.description).replace("task=event.delete","task=event.delete&urlhash="+encodeURIComponent(m.location.hash))).replace("task=event.edit","task=event.edit&urlhash="+encodeURIComponent(m.location.hash));var o=_.createElement("div");o.innerHTML=d,tippy(r,{interactive:!0,delay:100,arrow:!0,html:o,flipDuration:0,performance:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1},hide:{enabled:!1}}}})}e.fgcolor&&"list"!=a.name&&(r.style.color=e.fgcolor);var l=c[0].parentElement.querySelector(".dp-map");if(null!=l&&null!=l.dpmap&&u.show_map)for(var i=0;i<e.location.length;i++){var s=JSON.parse(JSON.stringify(e.location[i]));s.title=e.title,s.color=e.color;var d=e.description;e.url&&(d=d.replace(e.title,'<a href="'+e.url+'">'+e.title+"</a>")),s.description=d,p.Map.createMarker(l.dpmap,s)}},u.eventDataTransform=function(e){if(e.allDay){var t=moment(e.end);t.add(1,"day"),e.end=t}return e},u.eventDrop=function(a,e,n,t,r,o){if(a.resourceId)return n(),!1;p.request("task=event.move",function(e){if(e.data.url&&(a.url=e.data.url),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void n()}else n();else n()},"id="+a.id+"&minutes="+e.asMinutes()+"&allDay="+!a.start.hasTime())},u.eventResize=function(a,e,n,t,r,o){p.request("task=event.move",function(e){if(e.data.url&&(a.url=e.data.url),e.success)if(null!=e.messages){for(var t in e.messages)if("message"!=t)return void n()}else n();else n()},"id="+a.id+"&minutes="+e.asMinutes()+"&onlyEnd=1&allDay="+!a.start.hasTime())},u.eventClick=function(e,t,a){if(t.stopPropagation(),t.currentTarget._tippy&&t.currentTarget._tippy.hide(),2==u.show_event_as_popup)return!1;if(1==u.show_event_as_popup){var n=new Url(e.url);n.query.tmpl="component",p.modal(n,c.data("popupwidth"),c.data("popupheight"),function(e){var t=e.contentDocument||e.contentWindow.document;!t.getElementById("system-message-container")||t.getElementById("system-message-container").children.length<1||c.fullCalendar("refetchEvents")})}else m.location=p.encode(e.url);return!1},u.dayClick=function(e,t,a,n){var r=c[0].parentElement.querySelector(".dp-quickadd .dp-form");if(r){t.stopPropagation(),"month"==a.name&&(e.hours(8),e.minutes(0));var o=r.querySelector("#jform_start_date");o.value=e.format(o.getAttribute("data-format")),o.actualDate=o.value,(o=r.querySelector("#jform_start_date_time")).value=e.format(o.getAttribute("data-format")),o.actualDate=o.value,e.add("hours",1);var l=r.querySelector("#jform_end_date");if(l.value=e.format(l.getAttribute("data-format")),l.actualDate=l.value,(l=r.querySelector("#jform_end_date_time")).value=e.format(l.getAttribute("data-format")),l.actualDate=l.value,n){var i=n.id.split("-");r.querySelector('input[name="jform[location_ids][]"]').value=[i[0]],1<i.length&&(r.querySelector('input[name="jform[rooms][]"]').value=[n.id])}1==u.event_create_form&&600<m.innerWidth?(new Popper(t.target,r.parentElement,{onCreate:function(e){e.instance.popper.querySelector("#jform_title").focus()}}),r.parentElement.style.display="block"):(r.querySelector("input[name=task]").value="",r.submit())}else 0<u.header.right.indexOf("agendaDay")&&(c.fullCalendar("gotoDate",e),c.fullCalendar("changeView","agendaDay"))},u.customButtons={},u.header.left.indexOf("datepicker")&&(u.customButtons.datepicker={text:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_SHOW_DATEPICKER"),icon:"icon-calendar",click:function(){var e=_.querySelector(".fc-datepicker-button"),t=_.getElementById(c.attr("id")+"-datepicker-input");t||((t=_.createElement("input")).setAttribute("type","hidden"),t.id=c.attr("id")+"-datepicker-input",e.appendChild(t));var n=new Pikaday({field:t,trigger:e,i18n:{months:u.monthNames,weekdays:u.dayNames,weekdaysShort:u.dayNamesShort},onSelect:function(e){var t=n.getMoment(),a="year="+t.year()+"&month="+(t.month()+1)+"&day="+t.date()+"&view="+c.fullCalendar("getView").name;u.use_hash&&m.location.hash.replace(/&amp;/gi,"&")!=a?m.location.hash=a:c.fullCalendar("gotoDate",t),this.destroy()}});n.show()}}),u.header.left.indexOf("print")&&(u.customButtons.print={text:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-print",click:function(){var e=_.location.href.replace(/\?/,"?layout=print&tmpl=component&");e==_.location.href&&(e=_.location.href.replace(/#/,"?layout=print&tmpl=component#")),m.open(e).focus()}}),u.header.left.indexOf("add")&&u.event_create_url&&(u.customButtons.add={text:s.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-add",click:function(){location.href=u.event_create_url}}),u.loading=function(e){e?c[0].parentElement.parentElement.querySelector(".dp-loader").classList.remove("dp-loader_hidden"):c[0].parentElement.parentElement.querySelector(".dp-loader").classList.add("dp-loader_hidden")},c.data("eventSources",u.eventSources);var a=md5(JSON.stringify(u.eventSources));p.isLocalStorageSupported()&&(null==localStorage.getItem(c.attr("id")+a)?localStorage.setItem(c.attr("id")+a,JSON.stringify(u.eventSources)):u.eventSources=JSON.parse(localStorage.getItem(c.attr("id")+a)));var n=[];for(t=0;t<u.eventSources.length;t++)n.push({url:u.eventSources[t],success:p.extractEvents});u.eventSources=n,moment.updateLocale("en",{months:u.dayNames,monthsShort:u.monthNamesShort,weekdays:u.dayNames,weekdaysShort:u.dayNamesShort,weekdaysMin:u.dayNamesMin}),c.fullCalendar(u);var r=c[0].parentElement,o=r.querySelector(".com-dpcalendar-calendar__toggle");o&&o.addEventListener("click",function(){p.slideToggle(r.querySelector(".com-dpcalendar-calendar__list"),function(e){r.querySelector('[data-direction="down"]').style.display=e?(r.querySelector('[data-direction="up"]').style.display="inline","none"):(r.querySelector('[data-direction="up"]').style.display="none","inline")})});for(var l=c[0].parentElement.querySelectorAll(".com-dpcalendar-calendar__list .dp-input-checkbox"),i=0;i<l.length;i++){for(t=0;t<u.eventSources.length;t++)u.eventSources[t].url==l[i].value&&l[i].setAttribute("checked",!0);l[i].addEventListener("click",function(){p.updateCalendar(this,c)})}},p.updateCalendar=function(e,t){var a=md5(JSON.stringify(t.data("eventSources"))),n=p.isLocalStorageSupported()?JSON.parse(localStorage.getItem(t.attr("id")+a)):[],r={url:e.value,success:p.extractEvents};if(e.checked)t.fullCalendar("addEventSource",r),n.push(r.url);else{t.fullCalendar("removeEventSource",r);for(var o=0;o<n.length;o++)n[o]==r.url&&n.splice(o,1)}p.isLocalStorageSupported()&&localStorage.setItem(t.attr("id")+a,JSON.stringify(n))},p.extractEvents=function(e){return e.length&&null!=e[0].messages&&_.getElementById("system-message-container")&&s.renderMessages(e[0].messages),e.length&&null!=e[0].data?e[0].data:e}}(document,window,Joomla,DPCalendar,jQuery);
