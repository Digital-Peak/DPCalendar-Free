DPCalendar=window.DPCalendar||{},function(e,t,o){"use strict";e.addEventListener("DOMContentLoaded",function(){function r(t){var n=t.querySelector(".dp-map");if(null!=n){var e=function(){o.request("view=map&layout=events&format=raw",function(e){o.Map.clearMarkers(n),e.data.events.forEach(function(a){a.location.forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.title=a.title,t.color=a.color,t.description=a.description,o.Map.createMarker(n,t)})}),e.data.location&&-1!=t.querySelector(".dp-input[name=radius]").value&&o.Map.drawCircle(n,e.data.location,t.querySelector(".dp-input[name=radius]").value,t.querySelector('.dp-input[name="length-type"]').value)},o.formToQueryString(t.querySelector(".dp-form:not(.dp-timezone)")))};n.addEventListener("dp-map-loaded",e),n.dpmap&&e()}}[].slice.call(e.querySelectorAll(".dp-search-map")).forEach(function(n){if([].slice.call(n.querySelectorAll(".dp-input, .dp-select:not(.dp-timezone__select)")).forEach(function(e){e.addEventListener("change",function(e){return e.preventDefault(),r(n),!1})}),n.addEventListener("click",function(e){if(!e.target||!e.target.matches(".dp-event-tooltip__link"))return!0;if(window.innerWidth<600)return!0;e.preventDefault();var t=this.closest(".dp-search-map");if(1==t.dataset.popup){var a=new Url(e.target.getAttribute("href"));a.query.tmpl="component",o.modal(a,t.dataset.popupwidth,t.dataset.popupheight)}else window.location=o.encode(e.target.getAttribute("href"));return!1}),r(n),o.autocomplete){var a=n.querySelector(".dp-input_location");a&&(o.autocomplete.create(a),a.addEventListener("dp-autocomplete-select",function(e){r(n)}),a.addEventListener("dp-autocomplete-change",function(e){var t="location.searchloc";-1==window.location.href.indexOf("administrator")&&(t="locationform.searchloc"),o.request("task="+t+"&loc="+encodeURIComponent(e.target.value.trim()),function(e){o.autocomplete.setItems(a,e.data)})}))}var e;(e=n.querySelector(".dp-button-search"))&&e.addEventListener("click",function(e){return e.preventDefault(),r(n),!1}),(e=n.querySelector(".dp-button-clear"))&&e.addEventListener("click",function(e){e.preventDefault(),[].slice.call(n.querySelectorAll('.dp-input:not([name="Itemid"])')).forEach(function(e){e.value=""});var t=n.querySelector("[name=radius]");t.value=t.getAttribute("data-default")?t.getAttribute("data-default"):20;var a=n.querySelector("[name=length-type]");return a.value=a.getAttribute("data-default")?a.getAttribute("data-default"):"m",r(n),!1}),(e=n.querySelector(".dp-button-current-location"))&&(e.addEventListener("click",function(t){return t.preventDefault(),o.currentLocation(function(e){t.target.closest(".dp-form").querySelector("[name=location]").value=e,r(n)}),!1}),!1 in navigator&&(e.style.display="none"))})})}(document,Joomla,DPCalendar);