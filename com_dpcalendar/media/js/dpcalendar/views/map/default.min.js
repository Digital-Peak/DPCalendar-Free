DPCalendar=window.DPCalendar||{},function(e,t,o){"use strict";e.addEventListener("DOMContentLoaded",function(){var a=function(t){o.request("view=map&layout=events&format=raw",function(e){var r=t.querySelector(".dp-map");null!=r&&null!=r.dpmap&&(o.Map.clearMarkers(r.dpmap),e.data.events.forEach(function(n){n.location.forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.title=n.title,t.color=n.color,t.description=n.description,o.Map.createMarker(r.dpmap,t)})}),e.data.location&&-1!=t.querySelector(".dp-input[name=radius]").value&&o.Map.drawCircle(r.dpmap,e.data.location,t.querySelector(".dp-input[name=radius]").value,t.querySelector('.dp-input[name="length-type"]').value))},o.formToQueryString(t.querySelector(".dp-form:not(.dp-timezone)")))};[].slice.call(e.querySelectorAll(".dp-search-map")).forEach(function(n){if([].slice.call(n.querySelectorAll(".dp-input, .dp-select:not(.dp-timezone__select)")).forEach(function(e){e.addEventListener("change",function(e){return e.preventDefault(),a(n),!1})}),n.addEventListener("click",function(e){if(!e.target||!e.target.matches(".dp-event-tooltip__link"))return!0;if(window.innerWidth<600)return!0;e.preventDefault();var t=this.closest(".dp-search-map");if(1==t.dataset.popup){var n=new Url(e.target.getAttribute("href"));n.query.tmpl="component",o.modal(n,t.dataset.popupwidth,t.dataset.popupheight)}else window.location=o.encode(e.target.getAttribute("href"));return!1}),a(n),o.autocomplete){var r=n.querySelector(".dp-input_location");o.autocomplete.create(r),r.addEventListener("dp-autocomplete-select",function(e){a(n)}),r.addEventListener("dp-autocomplete-change",function(e){var t="location.searchloc";-1==window.location.href.indexOf("administrator")&&(t="locationform.searchloc"),o.request("task="+t+"&loc="+encodeURIComponent(e.target.value.trim()),function(e){o.autocomplete.setItems(r,e.data)})})}var e;(e=n.querySelector(".dp-button-search"))&&e.addEventListener("click",function(e){return e.preventDefault(),a(n),!1}),(e=n.querySelector(".dp-button-clear"))&&e.addEventListener("click",function(e){return e.preventDefault(),[].slice.call(n.querySelectorAll('.dp-input:not([name="Itemid"])')).forEach(function(e){e.value=""}),n.querySelector("[name=radius]").value=20,n.querySelector("[name=length-type]").value="m",a(n),!1}),(e=n.querySelector(".dp-button-current-location"))&&(e.addEventListener("click",function(t){return t.preventDefault(),o.currentLocation(function(e){t.target.closest(".dp-form").querySelector("[name=location]").value=e,a(n)}),!1}),!1 in navigator&&(e.style.display="none"))})})}(document,Joomla,DPCalendar);
