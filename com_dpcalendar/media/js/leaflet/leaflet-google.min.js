L.GridLayer.GoogleMutant=L.GridLayer.extend({options:{minZoom:0,maxZoom:23,tileSize:256,subdomains:"abc",errorTileUrl:"",attribution:"",opacity:1,continuousWorld:!1,noWrap:!1,type:"roadmap",maxNativeZoom:21},initialize:function(t){L.GridLayer.prototype.initialize.call(this,t),this._ready=!!window.google&&!!window.google.maps&&!!window.google.maps.Map,this._GAPIPromise=this._ready?Promise.resolve(window.google):new Promise(function(t,e){var n=0,i=null;i=setInterval(function(){return 10<=n?(clearInterval(i),e(new Error("window.google not found after 10 attempts"))):window.google&&window.google.maps&&window.google.maps.Map?(clearInterval(i),t(window.google)):void n++},500)}),this._tileCallbacks={},this._freshTiles={},this._imagesPerTile="hybrid"===this.options.type?2:1,this._boundOnMutatedImage=this._onMutatedImage.bind(this)},onAdd:function(e){L.GridLayer.prototype.onAdd.call(this,e),this._initMutantContainer(),this._GAPIPromise.then(function(){if(this._ready=!0,this._map=e,this._initMutant(),e.on("viewreset",this._reset,this),this.options.updateWhenIdle?e.on("moveend",this._update,this):e.on("move",this._update,this),e.on("zoomend",this._handleZoomAnim,this),e.on("resize",this._resize,this),google.maps.event.addListenerOnce(this._mutant,"idle",function(){this._checkZoomLevels(),this._mutantIsReady=!0}.bind(this)),e._controlCorners.bottomright.style.marginBottom="20px",e._controlCorners.bottomleft.style.marginBottom="20px",this._reset(),this._update(),this._subLayers)for(var t in this._subLayers)this._subLayers[t].setMap(this._mutant)}.bind(this))},onRemove:function(t){L.GridLayer.prototype.onRemove.call(this,t),this._observer.disconnect(),t._container.removeChild(this._mutantContainer),google.maps.event.clearListeners(t,"idle"),google.maps.event.clearListeners(this._mutant,"idle"),t.off("viewreset",this._reset,this),t.off("move",this._update,this),t.off("moveend",this._update,this),t.off("zoomend",this._handleZoomAnim,this),t.off("resize",this._resize,this),t._controlCorners&&(t._controlCorners.bottomright.style.marginBottom="0em",t._controlCorners.bottomleft.style.marginBottom="0em")},getAttribution:function(){return this.options.attribution},setElementSize:function(t,e){t.style.width=e.x+"px",t.style.height=e.y+"px"},addGoogleLayer:function(e,n){return this._subLayers||(this._subLayers={}),this._GAPIPromise.then(function(){var t=new google.maps[e](n);return t.setMap(this._mutant),this._subLayers[e]=t}.bind(this))},removeGoogleLayer:function(t){var e=this._subLayers&&this._subLayers[t];e&&(e.setMap(null),delete this._subLayers[t])},_initMutantContainer:function(){this._mutantContainer||(this._mutantContainer=L.DomUtil.create("div","leaflet-google-mutant leaflet-top leaflet-left"),this._mutantContainer.id="_MutantContainer_"+L.Util.stamp(this._mutantContainer),this._mutantContainer.style.zIndex="800",this._mutantContainer.style.pointerEvents="none",L.DomEvent.off(this._mutantContainer)),this._map.getContainer().appendChild(this._mutantContainer),this.setOpacity(this.options.opacity),this.setElementSize(this._mutantContainer,this._map.getSize()),this._attachObserver(this._mutantContainer)},_initMutant:function(){if(this._ready&&this._mutantContainer)if(this._mutant)this._resize();else{this._mutantCenter=new google.maps.LatLng(0,0);var t=new google.maps.Map(this._mutantContainer,{center:this._mutantCenter,zoom:0,tilt:0,mapTypeId:this.options.type,disableDefaultUI:!0,keyboardShortcuts:!1,draggable:!1,disableDoubleClickZoom:!0,scrollwheel:!1,streetViewControl:!1,styles:this.options.styles||{},backgroundColor:"transparent"});this._mutant=t,google.maps.event.addListenerOnce(t,"idle",function(){for(var t=this._mutantContainer.querySelectorAll("a"),e=0;e<t.length;e++)t[e].style.pointerEvents="auto"}.bind(this)),this.fire("spawned",{mapObject:t})}},_attachObserver:function(t){this._observer||(this._observer=new MutationObserver(this._onMutations.bind(this))),this._observer.observe(t,{childList:!0,subtree:!0}),Array.prototype.forEach.call(t.querySelectorAll("img"),this._boundOnMutatedImage)},_onMutations:function(t){for(var e=0;e<t.length;++e)for(var n=t[e],i=0;i<n.addedNodes.length;++i){var o=n.addedNodes[i];o instanceof HTMLImageElement?this._onMutatedImage(o):o instanceof HTMLElement&&(Array.prototype.forEach.call(o.querySelectorAll("img"),this._boundOnMutatedImage),"white"===o.style.backgroundColor&&L.DomUtil.remove(o),0===o.textContent.indexOf("For development purposes only")&&L.DomUtil.remove(o),Array.prototype.forEach.call(o.querySelectorAll('div[draggable=false][style*="text-align: center"]'),L.DomUtil.remove))}},_roadRegexp:/!1i(\d+)!2i(\d+)!3i(\d+)!/,_satRegexp:/x=(\d+)&y=(\d+)&z=(\d+)/,_staticRegExp:/StaticMapService\.GetMapImage/,_onMutatedImage:function(t){var e,n=t.src.match(this._roadRegexp),i=0;if(n?(e={z:n[1],x:n[2],y:n[3]},1<this._imagesPerTile&&(i=t.style.zIndex=1)):((n=t.src.match(this._satRegexp))&&(e={x:n[1],y:n[2],z:n[3]}),i=0),e){var o=this._tileCoordsToKey(e);t.style.position="absolute",t.style.visibility="hidden";var r=o+"/"+i;if(this._freshTiles[r]=t,r in this._tileCallbacks&&this._tileCallbacks[r])this._tileCallbacks[r].pop()(t),this._tileCallbacks[r].length||delete this._tileCallbacks[r];else if(this._tiles[o]){var a=this._tiles[o].el,s=0===i?a.firstChild:a.firstChild.nextSibling,l=this._clone(t);a.replaceChild(l,s)}}else t.src.match(this._staticRegExp)&&(t.style.visibility="hidden")},createTile:function(t,n){var e=this._tileCoordsToKey(t),i=L.DomUtil.create("div");i.dataset.pending=this._imagesPerTile,n=n.bind(this,null,i);for(var o=0;o<this._imagesPerTile;o++){var r=e+"/"+o;if(r in this._freshTiles){var a=this._freshTiles[r];i.appendChild(this._clone(a)),i.dataset.pending--}else this._tileCallbacks[r]=this._tileCallbacks[r]||[],this._tileCallbacks[r].push(function(e){return function(t){e.appendChild(this._clone(t)),e.dataset.pending--,parseInt(e.dataset.pending)||n()}.bind(this)}.bind(this)(i))}return parseInt(i.dataset.pending)||L.Util.requestAnimFrame(n),i},_clone:function(t){var e=t.cloneNode(!0);return e.style.visibility="visible",e},_checkZoomLevels:function(){var t=this._map.getZoom(),e=this._mutant.getZoom();t&&e&&(e!==t||e>this.options.maxNativeZoom)&&this._setMaxNativeZoom(e)},_setMaxNativeZoom:function(t){t!=this.options.maxNativeZoom&&(this.options.maxNativeZoom=t,this._resetView())},_reset:function(){this._initContainer()},_update:function(){if(this._mutant){var t=this._map.getCenter(),e=new google.maps.LatLng(t.lat,t.lng);this._mutant.setCenter(e);var n=this._map.getZoom(),i=n!==Math.round(n),o=this._mutant.getZoom();i||n==o||(this._mutant.setZoom(n),this._mutantIsReady&&this._checkZoomLevels())}L.GridLayer.prototype._update.call(this)},_resize:function(){var t=this._map.getSize();this._mutantContainer.style.width===t.x&&this._mutantContainer.style.height===t.y||(this.setElementSize(this._mutantContainer,t),this._mutant&&google.maps.event.trigger(this._mutant,"resize"))},_handleZoomAnim:function(){if(this._mutant){var t=this._map.getCenter(),e=new google.maps.LatLng(t.lat,t.lng);this._mutant.setCenter(e),this._mutant.setZoom(Math.round(this._map.getZoom()))}},_removeTile:function(t){if(this._mutant)return setTimeout(this._pruneTile.bind(this,t),1e3),L.GridLayer.prototype._removeTile.call(this,t)},_pruneTile:function(t){for(var e=this._mutant.getZoom(),n=t.split(":")[2],i=this._mutant.getBounds(),o=i.getSouthWest(),r=i.getNorthEast(),a=L.latLngBounds([[o.lat(),o.lng()],[r.lat(),r.lng()]]),s=0;s<this._imagesPerTile;s++){var l=t+"/"+s;if(l in this._freshTiles){var u=this._map&&this._keyToBounds(t);this._map&&u.overlaps(a)&&n==e||delete this._freshTiles[l]}}}}),L.gridLayer.googleMutant=function(t){return new L.GridLayer.GoogleMutant(t)},function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e():"function"==typeof define&&define.amd?define(e):e()}(0,function(){"use strict";function t(e){var n=this.constructor;return this.then(function(t){return n.resolve(e()).then(function(){return t})},function(t){return n.resolve(e()).then(function(){return n.reject(t)})})}var e=setTimeout;function i(){}function r(t){if(!(this instanceof r))throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],h(t,this)}function o(n,i){for(;3===n._state;)n=n._value;0!==n._state?(n._handled=!0,r._immediateFn(function(){var t=1===n._state?i.onFulfilled:i.onRejected;if(null!==t){var e;try{e=t(n._value)}catch(t){return void s(i.promise,t)}a(i.promise,e)}else(1===n._state?a:s)(i.promise,n._value)})):n._deferreds.push(i)}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if(t instanceof r)return e._state=3,e._value=t,void l(e);if("function"==typeof n)return void h(function(t,e){return function(){t.apply(e,arguments)}}(n,t),e)}e._state=1,e._value=t,l(e)}catch(t){s(e,t)}}function s(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&r._immediateFn(function(){t._handled||r._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)o(t,t._deferreds[e]);t._deferreds=null}function u(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function h(t,e){var n=!1;try{t(function(t){n||(n=!0,a(e,t))},function(t){n||(n=!0,s(e,t))})}catch(t){if(n)return;n=!0,s(e,t)}}r.prototype.catch=function(t){return this.then(null,t)},r.prototype.then=function(t,e){var n=new this.constructor(i);return o(this,new u(t,e,n)),n},r.prototype.finally=t,r.all=function(e){return new r(function(i,o){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var r=Array.prototype.slice.call(e);if(0===r.length)return i([]);var a=r.length;function s(e,t){try{if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void n.call(t,function(t){s(e,t)},o)}r[e]=t,0==--a&&i(r)}catch(t){o(t)}}for(var t=0;t<r.length;t++)s(t,r[t])})},r.resolve=function(e){return e&&"object"==typeof e&&e.constructor===r?e:new r(function(t){t(e)})},r.reject=function(n){return new r(function(t,e){e(n)})},r.race=function(o){return new r(function(t,e){for(var n=0,i=o.length;n<i;n++)o[n].then(t,e)})},r._immediateFn="function"==typeof setImmediate&&function(t){setImmediate(t)}||function(t){e(t,0)},r._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)};var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")}();"Promise"in n?n.Promise.prototype.finally||(n.Promise.prototype.finally=t):n.Promise=r}),window.MutationObserver=window.MutationObserver||function(w){"use strict";function r(t){this._watched=[],this._listener=t}function L(t){var e={type:null,target:null,addedNodes:[],removedNodes:[],previousSibling:null,nextSibling:null,attributeName:null,attributeNamespace:null,oldValue:null};for(var n in t)h(e,n)&&t[n]!==w&&(e[n]=t[n]);return e}r._period=30,r.prototype={observe:function(t,e){for(var n={attr:!!(e.attributes||e.attributeFilter||e.attributeOldValue),kids:!!e.childList,descendents:!!e.subtree,charData:!(!e.characterData&&!e.characterDataOldValue)},i=this._watched,o=0;o<i.length;o++)i[o].tar===t&&i.splice(o,1);e.attributeFilter&&(n.afilter=s(e.attributeFilter,function(t,e){return t[e]=!0,t},{})),i.push({tar:t,fn:function(i,o){var r=a(i,o);return function(t){var e,n=t.length;o.charData&&3===i.nodeType&&i.nodeValue!==r.charData&&t.push(new L({type:"characterData",target:i,oldValue:r.charData})),o.attr&&r.attr&&C(t,i,r.attr,o.afilter),(o.kids||o.descendents)&&(e=function(_,t,e,g){var v;function y(t,e,n,i,o){for(var r,a,s,l=t.length-1,u=-~((l-o)/2);s=t.pop();)r=n[s.i],a=i[s.j],g.kids&&u&&Math.abs(s.i-s.j)>=l&&(_.push(L({type:"childList",target:e,addedNodes:[r],removedNodes:[r],nextSibling:r.nextSibling,previousSibling:r.previousSibling})),u--),g.attr&&a.attr&&C(_,r,a.attr,g.afilter),g.charData&&3===r.nodeType&&r.nodeValue!==a.charData&&_.push(L({type:"characterData",target:r,oldValue:a.charData})),g.descendents&&b(r,a)}function b(t,e){for(var n,i,o,r,a,s,l,u=t.childNodes,h=e.kids,d=u.length,c=h?h.length:0,f=0,m=0,p=0;m<d||p<c;)(s=u[m])===(l=(a=h[p])&&a.node)?(g.attr&&a.attr&&C(_,s,a.attr,g.afilter),g.charData&&a.charData!==w&&s.nodeValue!==a.charData&&_.push(L({type:"characterData",target:s,oldValue:a.charData})),i&&y(i,t,u,h,f),g.descendents&&(s.childNodes.length||a.kids&&a.kids.length)&&b(s,a),m++,p++):(v=!0,n||(n={},i=[]),s&&(n[o=x(s)]||(n[o]=!0,-1===(r=T(h,s,p,function(t){return t}("node")))?g.kids&&(_.push(L({type:"childList",target:t,addedNodes:[s],nextSibling:s.nextSibling,previousSibling:s.previousSibling})),f++):i.push({i:m,j:r})),m++),l&&l!==u[m]&&(n[o=x(l)]||(n[o]=!0,-1===(r=T(u,l,m))?g.kids&&(_.push(L({type:"childList",target:e.node,removedNodes:[l],nextSibling:h[p+1],previousSibling:h[p-1]})),f--):i.push({i:r,j:p})),p++));i&&y(i,t,u,h,f)}return b(t,e),v}(t,i,r,o)),!e&&t.length===n||(r=a(i,o))}}(t,n)}),this._timeout||function(n){!function t(){var e=n.takeRecords();e.length&&n._listener(e,n),n._timeout=setTimeout(t,r._period)}()}(this)},takeRecords:function(){for(var t=[],e=this._watched,n=0;n<e.length;n++)e[n].fn(t);return t},disconnect:function(){this._watched=[],clearTimeout(this._timeout),this._timeout=null}};var t=document.createElement("i");t.style.top=0;var u=(t="null"!=t.attributes.style.value)?function(t,e){return e.value}:function(t,e){return"style"!==e.name?e.value:t.style.cssText};function C(t,e,n,i){for(var o,r,a={},s=e.attributes,l=s.length;l--;)r=(o=s[l]).name,i&&!h(i,r)||(u(e,o)!==n[r]&&t.push(L({type:"attributes",target:e,attributeName:r,oldValue:n[r],attributeNamespace:o.namespaceURI})),a[r]=!0);for(r in n)a[r]||t.push(L({target:e,type:"attributes",attributeName:r,oldValue:n[r]}))}function a(t,i){var o=!0;return function t(n){var e={node:n};return!i.charData||3!==n.nodeType&&8!==n.nodeType?(i.attr&&o&&1===n.nodeType&&(e.attr=s(n.attributes,function(t,e){return i.afilter&&!i.afilter[e.name]||(t[e.name]=u(n,e)),t},{})),o&&(i.kids||i.charData||i.attr&&i.descendents)&&(e.kids=function(t,e){for(var n=[],i=0;i<t.length;i++)n[i]=e(t[i],i,t);return n}(n.childNodes,t)),o=i.descendents):e.charData=n.nodeValue,e}(t)}var n=1,i="mo_id";function x(e){try{return e.id||(e[i]=e[i]||n++)}catch(t){try{return e.nodeValue}catch(t){return n++}}}function s(t,e,n){for(var i=0;i<t.length;i++)n=e(n,t[i],i,t);return n}function T(t,e,n,i){for(;n<t.length;n++)if((i?t[n][i]:t[n])===e)return n;return-1}function h(t,e){return t[e]!==w}return r}(void 0);
