DPCalendar=window.DPCalendar||{},function(l,r,d){"use strict";function i(e){[].slice.call(l.querySelectorAll(".com-dpcalendar-locationform__fields .dp-form-input")).forEach(function(e){"jform_title"!=e.id&&"jform_geocomplete"!=e.id&&(e.value="")}),l.getElementById("jform_number").value=e.number,l.getElementById("jform_street").value=e.street,l.getElementById("jform_city").value=e.city,l.getElementById("jform_province").value=e.province,l.getElementById("jform_country").value=e.country,l.getElementById("jform_zip").value=e.zip,l.getElementById("jform_latitude").value=e.latitude,l.getElementById("jform_longitude").value=e.longitude,""==l.getElementById("jform_title").value&&(l.getElementById("jform_title").value=e.formated)}l.addEventListener("DOMContentLoaded",function(){var n=l.getElementById("jform_geocomplete"),o=l.querySelector(".dp-map").dpmap,e=function(e){n.value="";var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),d.request("task="+t+"&loc="+encodeURIComponent(function(){var e="",t="",n="",o="";l.getElementById("jform_street").value&&(e=l.getElementById("jform_street").value,l.getElementById("jform_number").value&&(e+=" "+l.getElementById("jform_number").value),e+=", ");l.getElementById("jform_city").value&&(t=l.getElementById("jform_city").value,l.getElementById("jform_zip").value&&(t+=" "+l.getElementById("jform_zip").value),t+=", ");l.getElementById("jform_province").value&&(n=l.getElementById("jform_province").value+", ");l.getElementById("jform_country").value&&(o=l.getElementById("jform_country").value+", ");return e+t+n+o}()),function(e){e.data.latitude?(l.getElementById("jform_latitude").value=e.data.latitude,l.getElementById("jform_longitude").value=e.data.longitude,d.Map.moveMarker(o,a,e.data.latitude,e.data.longitude)):(l.getElementById("jform_latitude").value=0,l.getElementById("jform_longitude").value=0)})};l.getElementById("jform_street").addEventListener("change",e),l.getElementById("jform_number").addEventListener("change",e),l.getElementById("jform_zip").addEventListener("change",e),l.getElementById("jform_city").addEventListener("change",e),l.getElementById("jform_country").addEventListener("change",e),l.getElementById("jform_province").addEventListener("change",e);var a=d.Map.createMarker(o,{latitude:l.getElementById("jform_latitude").value,longitude:l.getElementById("jform_longitude").value},function(e,t){var n="location";-1==window.location.href.indexOf("administrator")&&(n="locationform"),d.request("task="+n+".loc&loc="+e+","+t,function(e){e.data&&i(e.data)})});d.autocomplete.create(n),n.addEventListener("dp-autocomplete-select",function(e){var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),d.request("task="+t+"&loc="+encodeURIComponent(e.detail.value),function(e){e.data&&(i(e.data),d.Map.moveMarker(o,a,e.data.latitude,e.data.longitude))})}),n.addEventListener("dp-autocomplete-change",function(e){var t="location.searchloc";-1==window.location.href.indexOf("administrator")&&(t="locationform.searchloc"),d.request("task="+t+"&loc="+encodeURIComponent(e.target.value.trim()),function(e){d.autocomplete.setItems(n,e.data)})}),n.parentElement.querySelector(".dp-button").addEventListener("click",function(e){e.preventDefault();var t=l.createEvent("CustomEvent");return t.initCustomEvent("dp-autocomplete-change",!1,!1,{value:n.value.trim()}),n.dispatchEvent(t),!1}),[].slice.call(l.querySelectorAll(".com-dpcalendar-locationform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(){r.submitbutton("locationform."+this.getAttribute("data-task"))})}),r.submitbutton=function(e){var t=l.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||l.formvalidator.isValid(t))&&r.submitform(e,t)}})}(document,Joomla,DPCalendar);