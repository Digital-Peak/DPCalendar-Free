DPCalendar=window.DPCalendar||{},function(e){"use strict";e.createCalendar=function(t,a){var n=function(e){e||(e=t.fullCalendar("getDate"));var a=t[0].querySelector('th[data-date^="'+e.format("YYYY-MM-DD")+'"]');if(a){var n=t[0].querySelector(".fc-time-area .fc-scroller");if(n){n.scrollLeft=0;var r=n.getBoundingClientRect(),o=a.getBoundingClientRect();n.scrollLeft=o.left+o.width/2-r.left-r.width/2}}};if(e.loader("hide",t.parent()[0]),a.use_hash){for(var r=window.location.hash.replace(/&amp;/gi,"&").split("&"),o=0;o<r.length;o++)r[o].match("^#year")&&(a.year=r[o].substring(6)),r[o].match("^month")&&(a.month=r[o].substring(6)),r[o].match("^day")&&(a.date=r[o].substring(4)),r[o].match("^view")&&(a.defaultView=r[o].substring(5));window.addEventListener("hashchange",function(){for(var e=new Date,n=e.getFullYear(),r=e.getMonth()+1,o=e.getDate(),l=a.defaultView,i=window.location.hash.replace(/&amp;/gi,"&").split("&"),s=0;s<i.length;s++)i[s].match("^#year")&&(n=i[s].substring(6)),i[s].match("^month")&&(r=i[s].substring(6)-1),i[s].match("^day")&&(o=i[s].substring(4)),i[s].match("^view")&&(l=i[s].substring(5));var d=new Date(n,r,o,0,0,0),c=t.fullCalendar("getDate"),u=t.fullCalendar("getView");d.getYear()==c.year()&&d.month()==c.month()&&d.date()==c.date()||t.fullCalendar("gotoDate",d),u.name!=l&&t.fullCalendar("changeView",l)})}a.defaultDate=moment(a.year+"-"+e.pad(parseInt(a.month),2)+"-"+e.pad(a.date,2)),document.body.clientWidth<a.screen_size_list_view&&(a.defaultView="list"),a.schedulerLicenseKey="GPL-My-Project-Is-Open-Source",a.weekNumberTitle="",a.theme=!1,a.startParam="date-start",a.endParam="date-end",a.eventLimitText=Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_MORE",!0),a.allDayText=Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_ALL_DAY",!0),a.buttonText={today:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_TODAY",!0),month:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_MONTH",!0),week:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_WEEK",!0),day:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_DAY",!0),list:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_LIST",!0)},a.listTexts={until:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_UNTIL",!0),past:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_PAST",!0),today:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TODAY",!0),tomorrow:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_TOMORROW",!0),thisWeek:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_WEEK",!0),nextWeek:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_WEEK",!0),thisMonth:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_THIS_MONTH",!0),nextMonth:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_NEXT_MONTH",!0),future:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_FUTURE",!0),week:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_VIEW_TEXTS_WEEK",!0)},a.viewRender=function(r){var o=t.fullCalendar("getDate"),l="year="+o.year()+"&month="+(o.month()+1)+"&day="+o.date()+"&view="+r.name;a.use_hash&&window.location.hash.replace(/&amp;/gi,"&")!=l&&(window.location.hash=l),n();var i=t[0].parentElement.querySelector(".dpcalendar-map");null!=i&&null!=i.dpmap&&a.show_map&&e.Map.clearMarkers(i.dpmap)},a.eventRender=function(n,r,o){var l=r.find(".fc-title");l.html(l.text());var i=r[0];if(n.view_class&&i.classList.add(n.view_class),n.description){m=(m=(m=n.description).replace("task=event.delete","task=event.delete&urlhash="+encodeURIComponent(window.location.hash))).replace("task=event.edit","task=event.edit&urlhash="+encodeURIComponent(window.location.hash));var s=document.createElement("div");s.innerHTML=m,tippy(i,{interactive:!0,delay:100,arrow:!0,html:s,flipDuration:0,performance:!0,popperOptions:{modifiers:{preventOverflow:{enabled:!1}}}})}n.fgcolor&&"list"!=o.name&&(i.style.color=n.fgcolor);var d=t[0].parentElement.querySelector(".dpcalendar-map");if(null!=d&&null!=d.dpmap&&a.show_map)for(var c=0;c<n.location.length;c++){var u=JSON.parse(JSON.stringify(n.location[c]));u.title=n.title,u.color=n.color;var m=n.description;n.url&&(m=m.replace(n.title,'<a href="'+n.url+'"">'+n.title+"</a>")),u.description=m,e.Map.createMarker(d.dpmap,u)}},a.eventDataTransform=function(e){if(e.allDay){var t=moment(e.end);t.add(1,"day"),e.end=t}return e},a.eventDrop=function(a,n,r,o,l,i){if(a.resourceId)return r(),!1;e.loader("show",t.parent()[0]),Joomla.request({method:"POST",url:"index.php?option=com_dpcalendar&task=event.move",data:"id="+a.id+"&minutes="+n.asMinutes()+"&allDay="+!a.start.hasTime(),onSuccess:function(n){e.loader("hide",t.parent()[0]);var o=JSON.parse(n);if(o.data.url&&(a.url=o.data.url),o.success)if(null!=o.messages){for(var l in document.getElementById("system-message-container")&&Joomla.renderMessages(o.messages),o.messages)if("message"!=l)return void r()}else r();else r()}})},a.eventResize=function(a,n,r,o,l,i){e.loader("show",t.parent()[0]),Joomla.request({method:"POST",url:"index.php?option=com_dpcalendar&task=event.move",data:"id="+a.id+"&minutes="+n.asMinutes()+"&onlyEnd=1&allDay="+!a.start.hasTime(),onSuccess:function(n){e.loader("hide",t.parent()[0]);var o=JSON.parse(n);if(o.data.url&&(a.url=o.data.url),o.success)if(null!=o.messages){for(var l in document.getElementById("system-message-container")&&Joomla.renderMessages(o.messages),o.messages)if("message"!=l)return void r()}else r();else r()}})},a.eventClick=function(n,r,o){if(r.stopPropagation(),r.currentTarget._tippy&&r.currentTarget._tippy.hide(),2==a.show_event_as_popup)return!1;if(1==a.show_event_as_popup){var l=new Url(n.url);l.query.tmpl="component",e.modal(l,t.data("popupwidth"),t.data("popupheight"),function(e){(e.contentDocument||e.contentWindow.document).getElementById("system-message").children.length<1||t.fullCalendar("refetchEvents")})}else window.location=e.encode(n.url);return!1},a.dayClick=function(e,n,r,o){var l=t[0].parentElement.querySelector("form[name=adminForm]");if(l){n.stopPropagation(),"month"==r.name&&e.hours(8);var i=l.querySelector("#jform_start_date");i.value=e.format(i.getAttribute("format"));var s=l.querySelector("#jform_end_date");if(s.value=e.format(s.getAttribute("format")),jQuery(l.querySelector("#jform_start_date_time")).timepicker("setTime",new Date(e.toISOString())),e.hours(e.hours()+1),jQuery(l.querySelector("#jform_end_date_time")).timepicker("setTime",new Date(e.toISOString())),o){var d=o.id.split("-");l.querySelector('input[name="jform[location_ids][]"]').value=[d[0]],d.length>1&&(l.querySelector('input[name="jform[rooms][]"]').value=[o.id])}1==a.event_create_form&&window.innerWidth>600?(new Popper(n.target,l.parentElement,{onCreate:function(e){e.instance.popper.querySelector("#jform_title").focus()}}),l.parentElement.style.display="block"):(l.querySelector("input[name=task]").value="",l.submit())}else a.header.right.indexOf("agendaDay")>0&&(t.fullCalendar("gotoDate",e),t.fullCalendar("changeView","agendaDay"))},a.customButtons={},a.header.left.indexOf("datepicker")&&(a.customButtons.datepicker={text:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_SHOW_DATEPICKER"),icon:"icon-calendar",click:function(){var e=document.querySelector(".fc-datepicker-button"),r=document.getElementById(t.attr("id")+"-datepicker-input");r||((r=document.createElement("input")).setAttribute("type","hidden"),r.id=t.attr("id")+"-datepicker-input",e.appendChild(r));var o=new Pikaday({field:r,trigger:e,i18n:{months:a.monthNames,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort},onSelect:function(e){var r=o.getMoment(),l="year="+r.year()+"&month="+(r.month()+1)+"&day="+r.date()+"&view="+t.fullCalendar("getView").name;a.use_hash&&window.location.hash.replace(/&amp;/gi,"&")!=l?window.location.hash=l:t.fullCalendar("gotoDate",r),n(r),this.destroy()}});o.show()}}),a.header.left.indexOf("print")&&(a.customButtons.print={text:Joomla.JText._("COM_DPCALENDAR_VIEW_CALENDAR_TOOLBAR_PRINT"),icon:"icon-print",click:function(){var e=document.location.href.replace(/\?/,"?layout=print&tmpl=component&");e==document.location.href&&(e=document.location.href.replace(/#/,"?layout=print&tmpl=component#")),window.open(e).focus()}}),a.loading=function(a){e.loader(a?"show":"hide",t.parent()[0])},t.data("eventSources",a.eventSources);var l=md5(JSON.stringify(a.eventSources));e.isLocalStorageSupported()&&(null==localStorage.getItem(t.attr("id")+l)?localStorage.setItem(t.attr("id")+l,JSON.stringify(a.eventSources)):a.eventSources=JSON.parse(localStorage.getItem(t.attr("id")+l)));var i=[];for(o=0;o<a.eventSources.length;o++)i.push({url:a.eventSources[o],success:e.extractEvents});a.eventSources=i,moment.updateLocale("en",{months:a.dayNames,monthsShort:a.monthNamesShort,weekdays:a.dayNames,weekdaysShort:a.dayNamesShort,weekdaysMin:a.dayNamesMin}),t.fullCalendar(a),n();var s=document.querySelector(".fc-icon-icon-print");s&&s.setAttribute("class",a.icon_print),(s=document.querySelector(".fc-icon-icon-calendar"))&&s.setAttribute("class",a.icon_calendar);var d=t[0].parentElement,c=d.querySelector(".dp-calendar-toggle");c&&c.addEventListener("click",function(t){e.slideToggle(d.querySelector(".dp-calendar-list"),function(e){e?(d.querySelector('i[data-direction="up"]').style.display="inline",d.querySelector('i[data-direction="down"]').style.display="none"):(d.querySelector('i[data-direction="up"]').style.display="none",d.querySelector('i[data-direction="down"]').style.display="inline")})});for(o=0;o<a.eventSources.length;o++)for(var u=t[0].parentElement.querySelectorAll(".dp-calendar-list input"),m=0;m<u.length;m++)a.eventSources[o].url==u[m].value&&u[m].setAttribute("checked",!0)},e.updateCalendar=function(t,a){var n=md5(JSON.stringify(a.data("eventSources"))),r=e.isLocalStorageSupported()?JSON.parse(localStorage.getItem(a.attr("id")+n)):[],o={url:t.val(),success:e.extractEvents};if(t.is(":checked"))a.fullCalendar("addEventSource",o),r.push(o.url);else{a.fullCalendar("removeEventSource",o);for(var l=0;l<r.length;l++)r[l]==o.url&&r.splice(l,1)}e.isLocalStorageSupported()&&localStorage.setItem(a.attr("id")+n,JSON.stringify(r))},e.extractEvents=function(e){return e.length&&null!=e[0].messages.message&&document.getElementById("system-message-container")&&Joomla.renderMessages(e[0].messages),e.length&&null!=e[0].data?e[0].data:e}}(DPCalendar);