DPCalendar=window.DPCalendar||{},Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement}while(null!==t);return null}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),function(i,l,a){"use strict";a.requestCounter=0,a.modal=function(e,t,o,n){var r=new tingle.modal({footer:!1,stickyFooter:!1,closeMethods:["overlay","button","escape"],cssClass:["dpcalendar-modal"],closeLabel:l.JText._("COM_DPCALENDAR_CLOSE","Close"),onClose:function(){n&&n(r.modalBox.children[0].querySelector("iframe"))},beforeOpen:function(){i.getSelection().removeAllRanges()}});t&&i.body.clientWidth>t&&(isNaN(t)||(t+="px"),i.querySelector(".tingle-modal-box").style.width=t),isNaN(o)||(o+="px"),r.setContent('<iframe width="100%" height="'+o+'" src="'+e.toString()+'" frameborder="0" allowfullscreen></iframe>'),r.open()},a.print=function(e){var t=i.querySelector(e).outerHTML;i.body.outerHTML=t,window.print(),window.location.reload(!1)},a.slideToggle=function(e,t){if(e){if(!e.getAttribute("data-max-height")){var o=window.getComputedStyle(e),n=o.display,r=o.position,i=o.visibility,l=e.offsetHeight;if("none"===n){e.style.visibility="hidden",e.style.display="block",l=e.offsetHeight;var a=window.getComputedStyle(e);l+=parseFloat(a.getPropertyValue("margin-top"))+parseFloat(a.marginBottom),e.style.display=n,e.style.position=r,e.style.visibility=i}e.style.maxHeight&&e.style.maxHeight<l&&(l=e.style.maxHeight,e.style.overflowY="auto"),e.style.transition="max-height 0.5s ease-in-out",e.style.overflowX="hidden",e.style.overflowY="hidden",e.style.maxHeight="none"===n?"0px":l+"px",e.style.display="block",e.setAttribute("data-max-height",l+"px")}var s="0"===e.style.maxHeight.replace("px","").replace("%","");t&&e.addEventListener("transitionend",function(){t(s)},{once:!0}),setTimeout(function(){e.style.maxHeight=s?e.getAttribute("data-max-height"):"0"},1)}},a.encode=function(e){return e.replace(/&amp;/g,"&")},a.pad=function(e,t){for(var o=e+"";o.length<t;)o="0"+o;return o},a.isLocalStorageSupported=function(){var e="test";try{return localStorage.setItem(e,"1"),localStorage.removeItem(e),!0}catch(e){return!1}},a.formToQueryString=function(e,t){for(var o,n=t?e.querySelectorAll(t):e.elements,r=[],i=0;i<n.length;i++)if((o=n[i]).name&&!o.disabled&&"file"!=o.type&&"reset"!=o.type&&"submit"!=o.type&&"button"!=o.type)if("select-multiple"==o.type)for(var l=n[i].options.length-1;0<=l;l--)o.options[l].selected&&(r[r.length]=encodeURIComponent(o.name)+"="+encodeURIComponent(o.options[l].value));else("checkbox"!=o.type&&"radio"!=o.type||o.checked)&&(r[r.length]=encodeURIComponent(o.name)+"="+encodeURIComponent(o.value));return r.join("&").replace(/%20/g,"+")},a.arrayToQueryString=function(e,t){var o,n=[];for(o in e)if(e.hasOwnProperty(o)){var r=t?t+"["+o+"]":o,i=e[o];n.push(null!==i&&"object"==typeof i?a.arrayToQueryString(i,r):encodeURIComponent(r)+"="+encodeURIComponent(i))}return n.join("&").replace(/%20/g,"+")},a.currentLocation=function(o){return!!navigator.geolocation&&(navigator.geolocation.getCurrentPosition(function(e){var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),a.request("task="+t+"&loc="+encodeURIComponent(e.coords.latitude+","+e.coords.longitude),function(e){o(e.data.formated)})},function(e){l.renderMessages({error:[e.message]})}),!0)},a.request=function(e,o,t){var n=i.querySelector(".dp-loader");n&&n.classList.remove("dp-loader_hidden"),t||(t=""),t+=(t?"&":"")+l.getOptions("csrf.token")+"=1",a.requestCounter++,l.request({url:l.getOptions("system.paths").base+"/index.php?option=com_dpcalendar&"+e,method:"POST",data:t,onSuccess:function(e){a.requestCounter--,n&&n.classList.add("dp-loader_hidden");var t=JSON.parse(e);null!=t.messages&&t.messages&&i.getElementById("system-message-container")&&l.renderMessages(t.messages),o&&o(t)},onError:function(e){a.requestCounter--,n&&n.classList.add("dp-loader_hidden");var t=JSON.parse(e);null!=t.messages&&i.getElementById("system-message-container")&&l.renderMessages(t.messages)}})},a.debounce=function(n,r,i){var l;return null==r&&(r=500),null==i&&(i=!1),function(){var e=this,t=arguments,o=i&&!l;clearTimeout(l),l=setTimeout(function(){l=null,i||n.apply(e,t)},r),o&&n.apply(e,t)}},i.addEventListener("DOMContentLoaded",function(){[].slice.call(i.querySelectorAll(".dp-button-print")).forEach(function(e){e.addEventListener("click",function(){a.print(e.getAttribute("data-selector"))})}),[].slice.call(i.querySelectorAll(".dp-button-action[data-href]")).forEach(function(e){e.addEventListener("click",function(){return location.href=this.getAttribute("data-href"),!1})});var e=i.querySelector(".dp-timezone .dp-select");e&&("undefined"!=typeof SlimSelect&&new SlimSelect({select:e}),e.addEventListener("change",function(){this.form.submit()})),a.isLocalStorageSupported()&&[].slice.call(i.querySelectorAll(".dp-tabs__input")).forEach(function(e){e.addEventListener("click",function(){localStorage.setItem("dp-tabs-"+this.name,this.id)}),localStorage.getItem("dp-tabs-"+e.name)==e.id&&(e.checked=!0)}),[].slice.call(i.querySelectorAll(".dp-map")).forEach(function(e){if(null!=a.Map){var t=e.dataset;t.width&&(e.style.width=t.width),t.height&&(e.style.height=t.height);var n=a.Map.create(e),o=e.closest(".dp-location");null==o&&(o=e.closest(".dp-locations")),null!=o&&[].slice.call(o.querySelectorAll(".dp-location__details")).forEach(function(e){var t=e.dataset,o=e.parentElement.querySelector(".dp-location__description");!t.description&&o&&(t.description=o.innerHTML),a.Map.createMarker(n,t)})}})})}(document,Joomla,DPCalendar);
