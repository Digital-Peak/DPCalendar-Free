DPCalendar=window.DPCalendar||{},function(r,l,i){"use strict";function d(e){[].slice.call(r.querySelectorAll(".com-dpcalendar-locationform__fields .dp-form-input")).forEach(function(e){"jform_title"!=e.id&&"jform_geocomplete"!=e.id&&(e.value="")}),r.getElementById("jform_number")&&(r.getElementById("jform_number").value=e.number),r.getElementById("jform_street")&&(r.getElementById("jform_street").value=e.street),r.getElementById("jform_city")&&(r.getElementById("jform_city").value=e.city),r.getElementById("jform_province")&&(r.getElementById("jform_province").value=e.province),r.getElementById("jform_country")&&(r.getElementById("jform_country").value=e.country),r.getElementById("jform_zip")&&(r.getElementById("jform_zip").value=e.zip),r.getElementById("jform_latitude").value=e.latitude,r.getElementById("jform_longitude").value=e.longitude,""==r.getElementById("jform_title").value&&(r.getElementById("jform_title").value=e.formated)}r.addEventListener("DOMContentLoaded",function(){function o(){if(a.dpmap.dpMarkers.length||i.Map.createMarker(a,{latitude:r.getElementById("jform_latitude").value,longitude:r.getElementById("jform_longitude").value,color:r.getElementById("jform_color").value},function(e,t){var o="location";-1==window.location.href.indexOf("administrator")&&(o="locationform"),i.request("task="+o+".loc&loc="+e+","+t,function(e){e.data&&d(e.data)})}),a.dpmap.dpMarkers.length)return a.dpmap.dpMarkers[0]}var n=r.getElementById("jform_geocomplete"),a=r.querySelector(".dp-map");[].slice.call(r.querySelectorAll("#jform_street,#jform_number,#jform_zip,#jform_city,#jform_country,#jform_province")).forEach(function(e){e.addEventListener("change",function(){n.value="";var e="location.loc";-1==window.location.href.indexOf("administrator")&&(e="locationform.loc"),i.request("task="+e+"&loc="+encodeURIComponent(function(){function e(e){var t=r.getElementById("jform_"+e);return t?t.value+", ":""}var t=e("street");if(t){var o=e("number");o&&(t=t.substr(0,t.length-2)+" "+o)}var n=e("city");if(n){var a=e("zip");a&&(n+=n.substr(0,n.length-2)+" "+a)}return t+n+e("province")+e("country")}()),function(e){e.data.latitude?(r.getElementById("jform_latitude").value=e.data.latitude,r.getElementById("jform_longitude").value=e.data.longitude,i.Map.moveMarker(a,o(),e.data.latitude,e.data.longitude)):(r.getElementById("jform_latitude").value=0,r.getElementById("jform_longitude").value=0)})})}),window.jQuery?jQuery("#jform_color").change(function(){i.Map.clearMarkers(a),o()}):r.getElementById("jform_color").addEventListener("change",function(){i.Map.clearMarkers(a),o()}),o(),i.autocomplete.create(n),n.addEventListener("dp-autocomplete-select",function(e){var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),i.request("task="+t+"&loc="+encodeURIComponent(e.detail.value),function(e){e.data&&(d(e.data),i.Map.moveMarker(a,o(),e.data.latitude,e.data.longitude))})}),n.addEventListener("dp-autocomplete-change",function(e){var t="location.searchloc";-1==window.location.href.indexOf("administrator")&&(t="locationform.searchloc"),i.request("task="+t+"&loc="+encodeURIComponent(e.target.value.trim()),function(e){i.autocomplete.setItems(n,e.data)})}),n.parentElement.querySelector(".dp-button").addEventListener("click",function(e){e.preventDefault();var t=r.createEvent("CustomEvent");return t.initCustomEvent("dp-autocomplete-change",!1,!1,{value:n.value.trim()}),n.dispatchEvent(t),!1}),[].slice.call(r.querySelectorAll(".com-dpcalendar-locationform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(){l.submitbutton("locationform."+this.getAttribute("data-task"))})}),l.submitbutton=function(e){var t=r.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||r.formvalidator.isValid(t))&&l.submitform(e,t)}})}(document,Joomla,DPCalendar);
