DPCalendar=window.DPCalendar||{},function(l,r,i){"use strict";function d(e){[].slice.call(l.querySelectorAll(".com-dpcalendar-locationform__fields .dp-form-input")).forEach(function(e){"jform_title"!=e.id&&"jform_geocomplete"!=e.id&&(e.value="")}),l.getElementById("jform_number")&&(l.getElementById("jform_number").value=e.number),l.getElementById("jform_street")&&(l.getElementById("jform_street").value=e.street),l.getElementById("jform_city")&&(l.getElementById("jform_city").value=e.city),l.getElementById("jform_province")&&(l.getElementById("jform_province").value=e.province),l.getElementById("jform_country")&&(l.getElementById("jform_country").value=e.country),l.getElementById("jform_zip")&&(l.getElementById("jform_zip").value=e.zip),l.getElementById("jform_latitude").value=e.latitude,l.getElementById("jform_longitude").value=e.longitude,""==l.getElementById("jform_title").value&&(l.getElementById("jform_title").value=e.formated)}l.addEventListener("DOMContentLoaded",function(){var o=l.getElementById("jform_geocomplete"),n=l.querySelector(".dp-map").dpmap;[].slice.call(l.querySelectorAll("#jform_street,#jform_number,#jform_zip,#jform_city,#jform_country,#jform_province")).forEach(function(e){e.addEventListener("change",function(e){o.value="";var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),i.request("task="+t+"&loc="+encodeURIComponent(function(){var e=function(e){var t=l.getElementById("jform_"+e);return t?t.value+", ":""},t=e("street");if(t){var o=e("number");o&&(t=t.substr(0,t.length-2)+o)}var n=e("city");if(n){var a=e("zip");a&&(n+=n.substr(0,n.length-2)+a)}return t+n+e("province")+e("country")}()),function(e){e.data.latitude?(l.getElementById("jform_latitude").value=e.data.latitude,l.getElementById("jform_longitude").value=e.data.longitude,i.Map.moveMarker(n,a,e.data.latitude,e.data.longitude)):(l.getElementById("jform_latitude").value=0,l.getElementById("jform_longitude").value=0)})})});var a=i.Map.createMarker(n,{latitude:l.getElementById("jform_latitude").value,longitude:l.getElementById("jform_longitude").value},function(e,t){var o="location";-1==window.location.href.indexOf("administrator")&&(o="locationform"),i.request("task="+o+".loc&loc="+e+","+t,function(e){e.data&&d(e.data)})});i.autocomplete.create(o),o.addEventListener("dp-autocomplete-select",function(e){var t="location.loc";-1==window.location.href.indexOf("administrator")&&(t="locationform.loc"),i.request("task="+t+"&loc="+encodeURIComponent(e.detail.value),function(e){e.data&&(d(e.data),a||(a=i.Map.createMarker(n,{latitude:l.getElementById("jform_latitude").value,longitude:l.getElementById("jform_longitude").value})),a&&i.Map.moveMarker(n,a,e.data.latitude,e.data.longitude))})}),o.addEventListener("dp-autocomplete-change",function(e){var t="location.searchloc";-1==window.location.href.indexOf("administrator")&&(t="locationform.searchloc"),i.request("task="+t+"&loc="+encodeURIComponent(e.target.value.trim()),function(e){i.autocomplete.setItems(o,e.data)})}),o.parentElement.querySelector(".dp-button").addEventListener("click",function(e){e.preventDefault();var t=l.createEvent("CustomEvent");return t.initCustomEvent("dp-autocomplete-change",!1,!1,{value:o.value.trim()}),o.dispatchEvent(t),!1}),[].slice.call(l.querySelectorAll(".com-dpcalendar-locationform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(){r.submitbutton("locationform."+this.getAttribute("data-task"))})}),r.submitbutton=function(e){var t=l.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||l.formvalidator.isValid(t))&&r.submitform(e,t)}})}(document,Joomla,DPCalendar);
