DPCalendar=window.DPCalendar||{},function(o,r,a){"use strict";function i(){if(r.getOptions("DPCalendar.price.url")&&o.querySelector(".dp-price-total__content")){var e=o.querySelector(".com-dpcalendar-bookingform__form"),t=a.formToQueryString(e,'input:not([name="task"]), select');a.request(r.getOptions("DPCalendar.price.url"),function(d){Object.keys(d.data.events).map(function(c){var l=e.querySelector('[data-event-id="'+c+'"]');Object.keys(d.data.events[c]).map(function(a){Object.keys(d.data.events[c][a]).map(function(e){var t=d.data.events[c][a][e],n=a.substring(0,a.length-1),i=l.querySelector("[data-"+n+'-price="'+e+'"]');if(i){var o,r=i.querySelector(".dp-price__live");if(r)if(r.innerHTML=t.discount,t.discount!=t.original)i.querySelector(".dp-price__live").classList.remove("dp-price_hidden"),i.querySelector(".dp-price__original").classList.remove("dp-price_hidden"),i.querySelector(".dp-price__original").innerHTML=t.original,(o=i.querySelector(".dp-"+n+"__price-info .dp-icon"))&&o.classList.remove("dp-price_hidden");else i.querySelector(".dp-price__original").classList.add("dp-price_hidden"),(o=i.querySelector(".dp-"+n+"__price-info .dp-icon"))&&o.classList.add("dp-price_hidden")}})})}),o.querySelector(".dp-price-total__content").innerHTML=d.data.total},t)}}o.addEventListener("DOMContentLoaded",function(){i(),[].slice.call(o.querySelectorAll(".dp-booking-series__input label")).forEach(function(e){i()}),[].slice.call(o.querySelectorAll(".dp-booking-series__input input")).forEach(function(e){e.addEventListener("click",function(){var t=o.getElementById("jform_series0").checked;[].slice.call(o.querySelectorAll(".com-dpcalendar-bookingform__events .dp-event_instance")).forEach(function(e){e.style.display=t?"inherit":"none",e.querySelector("select").value=t?"1":"0"}),i()})}),[].slice.call(o.querySelectorAll(".dp-ticket__amount .dp-select, .dp-option__amount .dp-select")).forEach(function(e){e.addEventListener("change",function(){i()})});var n=[].slice.call(o.querySelectorAll(".com-dpcalendar-bookingform__fields .dp-input-terms"));n.forEach(function(e){e.addEventListener("change",function(){var t=!0;n.forEach(function(e){e.checked||(t=!1)}),o.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!t})}),n.length&&(o.querySelector(".com-dpcalendar-bookingform .dp-button-save").disabled=!0),[].slice.call(o.querySelectorAll(".com-dpcalendar-bookingform__actions .dp-button")).forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=o.querySelectorAll(".dp-payment-option");"save"==this.getAttribute("data-task")&&1==t.length&&(t[0].querySelector(".dp-payment-option__input").checked=!0);var n=o.querySelector(".dp-price-total__content");if("save"==this.getAttribute("data-task")&&n&&n.innerHTML&&1<t.length&&!o.querySelectorAll(".dp-payment-option__input:checked").length){var i=o.getElementsByName("adminForm")[0];return i&&!o.formvalidator.isValid(i)||(a.slideToggle(o.querySelector(".com-dpcalendar-bookingform__payment-options")),[].slice.call(o.querySelectorAll(".dp-payment-option")).forEach(function(e){e.addEventListener("click",function(){this.querySelector(".dp-payment-option__input").checked=!0,r.submitbutton("bookingform.save")})})),!1}return r.submitbutton("bookingform."+this.getAttribute("data-task")),!1})}),r.submitbutton=function(e){var t=o.getElementsByName("adminForm")[0];t&&(-1<e.indexOf("cancel")||-1<e.indexOf("delete")||o.formvalidator.isValid(t))&&r.submitform(e,t)}}),a.updateBookingMail=function(e){a.request("task=booking.mail",function(e){e.success&&(o.getElementById("jform_name").value=e.data.name,o.getElementById("jform_email").value=e.data.email)},"ajax=1&id="+o.getElementById("jform_user_id_id").value)}}(document,Joomla,DPCalendar);
